<!doctype html>
<html lang="id">
<head> 
  <meta charset="utf-8">
  <title>buat ade — ulang tahun (v4)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <meta name="description" content="surat ulang tahun interaktif untuk ade dari mas.">
  <meta property="og:title" content="buat ade — ulang tahun">
  <meta property="og:description" content="surat ulang tahun interaktif untuk ade dari mas.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="assets/foto1.jpg">
  <meta name="theme-color" content="#ff6b81">
  <link rel="icon" href='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" rx="24" ry="24" fill="%23ff6b81"/><path d="M24 40h80v48c0 4.4-3.6 8-8 8H32c-4.4 0-8-3.6-8-8V40z" fill="%23fff5f7"/><path d="M24 40l40 28 40-28" fill="none" stroke="%23ff6b81" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/></svg>'>
  <link rel="preload" as="image" href="assets/foto1.jpg">
  <link rel="preload" as="image" href="assets/foto2.jpg">
  <link rel="preload" as="image" href="assets/foto3.jpg">
  <style>
    :root{
      --c-accent:#ff6b81; --c-soft:#ffd3e2; --c-paper:#fffafc; --c-text:#3a3a3a; --c-ink:#2a2a2a;
      --shadow:0 12px 30px rgba(0,0,0,.08);
      --maxw:960px; --gap:16px; --radius:20px; --speed:300ms;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif; color:var(--c-text);
      background:
        radial-gradient(1200px 600px at 100% -10%,rgba(255,107,129,.12),rgba(255,107,129,0) 60%),
        radial-gradient(800px 400px at -20% 110%,rgba(255,211,226,.25),rgba(255,211,226,0) 60%),
        linear-gradient(180deg,#fff, var(--c-paper));
    }
    .container{max-width:var(--maxw); margin-inline:auto; padding:20px;}
    header.toolbar{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:10px}
    .tag{display:inline-block; padding:6px 12px; border-radius:999px; background:var(--c-soft); color:var(--c-ink); font-weight:600}

    /* stage & page */
    .stage{ position:relative; display:grid; place-items:center; min-height:76vh; }
    .page{
      width:min(720px, 90vw); aspect-ratio:3/4; background:var(--c-paper);
      border-radius:var(--radius); box-shadow:var(--shadow); padding:clamp(14px,2.4vw,24px); overflow:hidden; position:relative;
      border:1px solid rgba(0,0,0,.06);
    }
    .page:before{ content:""; position:absolute; inset:0; pointer-events:none; background:
      linear-gradient(180deg,rgba(255,255,255,.8),rgba(255,255,255,0)),
      repeating-linear-gradient(0deg, rgba(0,0,0,.02), rgba(0,0,0,.02) 2px, rgba(0,0,0,0) 2px, rgba(0,0,0,0) 6px);
      mix-blend-mode:multiply; opacity:.8;
    }

    h1,h2,h3{margin:0 0 8px 0}
    h1{font-size:clamp(22px,4.6vw,34px); letter-spacing:.2px; color:var(--c-ink)}
    h2{font-size:clamp(16px,3.2vw,22px); opacity:.9; color:var(--c-ink)}
    p{margin:0 0 10px 0}
    .muted{opacity:.78}
    .center{text-align:center}

    .btn{appearance:none; border:0; background:var(--c-accent); color:#fff; padding:12px 18px; border-radius:999px; font-weight:700; cursor:pointer; box-shadow:0 10px 26px rgba(255,107,129,.35); transition:transform .08s ease, box-shadow .2s ease}
    .btn:hover{transform:translateY(-1px)}
    .btn.ghost{background:transparent; color:var(--c-accent); border:2px solid var(--c-accent); box-shadow:none}
    .btn.icon{ display:inline-grid; grid-auto-flow:column; align-items:center; gap:8px }

    /* generic content helpers */
    .content-center{display:grid; place-items:center; height:100%; text-align:center; gap:14px;}
    .content-stack {
      display: flex;
      flex-direction: column;
      justify-content: center; /* Memusatkan blok konten secara vertikal */
      height: 100%;
      text-align: center;
      gap: 20px; /* Jarak antara judul dan konten */
    }
    .reason-card p {
      font-size: 18px; /* Ukuran font diubah agar tidak terlalu besar */
      color: var(--c-text); /* Warna diubah agar tidak terlalu pekat */
      margin: 0;
      line-height: 1.5;
    }

    .fullimg{ position:relative; width:100%; height:100%; display:grid; place-items:center; }
    .fullimg img{ max-width:100%; max-height:100%; object-fit:contain; display:block; border-radius:14px; box-shadow:0 6px 24px rgba(0,0,0,.12); }
    .cover-bg{ position:absolute; inset:0; background-size:cover; background-position:center; filter:brightness(.92); }
    .cover-overlay{ position:absolute; inset:0; background:linear-gradient(180deg, rgba(255,250,252,.55), rgba(255,250,252,.25) 40%, rgba(255,250,252,0)); }
    .cover-content{ position:relative; z-index:2; background:rgba(255,250,252,.5); backdrop-filter:blur(4px); padding:20px; border-radius:16px; box-shadow:0 6px 20px rgba(0,0,0,.08) }
    .tap{ animation:tapblink 1.2s ease-in-out infinite }
    @keyframes tapblink{ 0%{opacity:.4} 50%{opacity:1} 100%{opacity:.4} }

    .reason-card, .gift-card{ background:#fff; padding:16px; border-radius:12px; box-shadow:0 4px 16px rgba(0,0,0,.07); animation:fade-item .4s ease both; }
    .reason-card:nth-child(2){animation-delay:.15s} .reason-card:nth-child(3){animation-delay:.3s}
    @keyframes fade-item{ from{opacity:0; transform:translateY(10px)} }

    .checklist{list-style:none; padding:0; text-align:left; width:min(560px,90%); margin:0 auto}
    .checklist li{display:flex; align-items:center; gap:10px; margin-bottom:8px; padding:10px 12px; border:1px solid rgba(0,0,0,.08); border-radius:12px; background:#fff}
    .checklist input{accent-color:var(--c-accent); width:20px; height:20px}

    .quiz{ display:grid; gap:12px; height:100%; align-content:center; justify-items:stretch; grid-auto-rows:max-content; padding-inline:clamp(4px,2vw,16px); }
    .choices{ display:grid; gap:10px; margin-top:8px }
    .choice{ padding:12px 14px; border:1px solid rgba(0,0,0,.12); border-radius:12px; cursor:pointer; background:#fff; text-align:left; font-size:16px; width:100%; }
    .choice:disabled{ opacity:.7 }
    .choice.correct { border-color: #28a745; background-color: #e9f7ec; }
    .choice.wrong { border-color: #dc3545; background-color: #fceeef; }


    .typewriter-text{ width:fit-content; margin-inline:auto; overflow:hidden; white-space:nowrap; border-right:2px solid var(--c-accent); animation:typing 2s steps(30, end), blink-caret .75s step-end infinite; }
    @keyframes typing{ from{width:0} to{width:100%} }
    @keyframes blink-caret{ from,to{border-color:transparent} 50%{border-color:var(--c-accent)} }

    /* candle */
    .cake{ position:relative; width:220px; height:140px; margin:0 auto; }
    .cake .body{ position:absolute; bottom:0; left:0; right:0; height:100px; background:linear-gradient(180deg,#ffd3e2,#ffb3c6); border-radius:16px; box-shadow:inset 0 4px 10px rgba(0,0,0,.06) }
    .cake .candle{ position:absolute; left:50%; transform:translateX(-50%); bottom:92px; width:12px; height:40px; background:#fff; border-radius:6px }
    .cake .flame{ position:absolute; left:50%; transform:translateX(-50%); bottom:130px; width:16px; height:26px; background:radial-gradient(circle at 50% 35%, #fff7b1 0%, #ffd166 60%, #ff6b6b 100%); border-radius:50% 50% 50% 50% / 60% 60% 40% 40%; filter:blur(.2px); box-shadow:0 0 16px 6px rgba(255,215,97,.6); transition:opacity .3s ease, transform .3s ease }
    .cake .flame.off{ opacity:0; transform:translateX(-50%) scale(.6); box-shadow:none }

    /* bottom navigation */
    .navwrap{ position:fixed; left:0; right:0; bottom:clamp(10px, env(safe-area-inset-bottom) + 10px, 24px); z-index:50; display:grid; place-items:center; pointer-events:none }
    .nav{ pointer-events:auto; display:flex; align-items:center; gap:12px; background:rgba(255,255,255,.92); backdrop-filter:blur(6px); border:1px solid rgba(0,0,0,.06); border-radius:999px; padding:8px 12px; box-shadow:0 8px 24px rgba(0,0,0,.12) }
    .nav .pill{ min-width:38px; height:38px; border-radius:999px; display:grid; place-items:center; font-size:18px; font-weight:700; color:#fff; background:var(--c-accent); border:0; cursor:pointer }
    .nav .pill:disabled{ opacity:.5; cursor:not-allowed }
    .nav .count{ font-weight:700; color:var(--c-ink); padding:0 6px }
    .prog{ position:absolute; left:50%; transform:translateX(-50%); bottom:calc(100% + 6px); width:min(720px,90vw); height:6px; background:rgba(0,0,0,.06); border-radius:999px; overflow:hidden }
    .prog>i{ display:block; height:100%; width:0%; background:var(--c-accent) }

    /* animations */
    .fade{ animation:fade .35s ease both }
    @keyframes fade{ from{ opacity:0; transform:translateY(6px) } }
    .slide{ animation:slide .35s ease both }
    @keyframes slide{ from{ transform:translateX(10px); opacity:0 } }

    footer{ text-align:center; font-size:12px; opacity:.7; padding:14px 0 56px }

    /* lightbox */
    .lightbox{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.85); z-index:1000 }
    .lightbox.open{ display:flex }
    .lightbox img{ max-width:92vw; max-height:86vh; border-radius:14px; box-shadow:0 16px 60px rgba(0,0,0,.6) }
    .lightbox .close{ position:absolute; top:16px; right:16px }

    /* reduced motion */
    @media (prefers-reduced-motion:reduce){
      .btn, .choice{ transition:none !important; animation:none !important }
    }
    #musicBtn{ position:fixed; top:16px; right:16px; z-index:100; font-size:24px; background:rgba(255,255,255,.9); border-radius:50%; width:44px; height:44px; border:0; cursor:pointer; box-shadow:0 8px 24px rgba(0,0,0,.12) }
  </style>
</head>
<body>
  <div class="container">
    <header class="toolbar" aria-label="toolbar">
      <span class="tag" id="whoTag"></span>
    </header>
    <div class="stage">
      <section id="page" class="page fade" aria-live="polite" aria-label="halaman"></section>
    </div>
    <footer class="muted">dibuat dengan <span id="emoji">💖</span> oleh <span id="fromName"></span></footer>
  </div>
  
  <div class="navwrap" aria-hidden="false">
    <div class="prog"><i id="prog"></i></div>
    <div class="nav" role="navigation" aria-label="navigasi halaman">
      <button class="pill" id="prevBtn" aria-label="halaman sebelumnya">⟵</button>
      <div class="count" id="pageCount">1/20</div>
      <button class="pill" id="nextBtn" aria-label="halaman berikutnya">⟶</button>
    </div>
  </div>
  
  <button id="musicBtn" aria-label="putar/hentikan musik" style="display:none;">🎵</button>
  <audio id="bgm" preload="none" loop></audio>

  <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-label="pratinjau gambar">
    <button class="btn ghost close" id="lbClose">tutup ✕</button>
    <img id="lbImg" alt="gambar pratinjau">
  </div>

  <div id="confetti" style="position:fixed;inset:0;pointer-events:none;overflow:visible"></div>

  <script>
  // =======================
  // KONFIG (edit di sini)
  // =======================
  window.APP_CONFIG = {
    // Info Dasar
    NAMA_PENERIMA: "Athiya",
    NAMA_PENGIRIM: "mas aren",
    NOMOR_WA_PENGIRIM: "6281234567890",

    // Aset & Musik
    BGM_SRC: "assets/bgm.mp3", // sarankan 10–15 detik, 128kbps, <1.5MB
    FOTO_1_COVER: "assets/foto1.jpg",
    FOTO_2_KOLASE: "assets/foto2.jpg",
    FOTO_3_GALERI: "assets/foto3.jpg",
    FOTO_4_SURAT: "assets/foto4.jpg",

    // Teks Halaman
    PAGE_01: {
      TITLE: "selamat ulang tahun, ade sayang ✨",
      COPY: "hari ini mas ngetuk layar ade, bawa banyak peluk yang nyampein rindu.",
    },
    PAGE_02: { COPY: "meski ada jarak antar kota, tiap halaman ini mas isi buat nemenin ade. anggep aja setiap geseran layar = mas jalan selangkah lebih deket. lama-lama bukan cuma layar, tapi mas beneran ada di sebelah ade." },
    PAGE_03: { COPY: "semoga hari ini penuh tawa. makasih sudah jadi cerita paling manis buat mas." },
    PAGE_04: {
      TITLE: "alasan mas bangga sama ade:",
      REASONS: [
        "<strong>cantik lucu ayuu</strong>",
        "<strong>pinter, cepet belajar, banyak bisanya</strong>",
        "<strong>baik, penurut, bisa kontrol diri walau lagi marah</strong>",
		"<strong>istriable banget</strong>",
		"<strong>dan masih banyak lagii..</strong>",
      ],
    },
    PAGE_05: { COPY: "ini koleksi favorit mas. tiap lihat, rasanya pulang." },
    PAGE_07: {
      TITLE: "🎁 hadiah dari mas yang udah nyampe ada makna yang ikut sampe ke hati juga",
      GIFTS: [
        { icon: "🌸", title: "bunga", desc: "buat ade yang selalu jadi obat hati mas, tiap kelopaknya sepertiucapan “semoga ade bahagia.”" },
        { icon: "👜", title: "tas", desc: "biar langkah ade enteng, apa pun yang ade bawa mas ikut jagain, seakan mas selalu di samping." },
        { icon: "🎁", title: "blindbox", desc: "kejutan kecil, kayak mas yang ga pernah habis idenya bikin ade senyum-senyum" },
      ],
      CLOSING: "kalo kangen, ade cukup liat ini.. rasanya mas hadir nemenin ade, walau dari jauh.",
    },
    PAGE_08: {
      TITLE: "ada banyak hal sederhana yang bisa bikin jarak kita ga kerasa jauh. ini wishlist kecil kita, biar tiap hari ada alasan senyum 💌",
      PLANS: [
        "tium online tiap hari",
		"kirim pap",
		"movie night sambil vc",
		"dinner virtual",
		"main roblox bareng",
		"foto ‘tangan love’ tiap minggu",
		"doa bareng sebelum bobo",
		"ngobrol sebelum bobo",
      ],
    },
    PAGE_09: { COPY: "coba kita flashback dikit yuk 🥰\npilih jawaban yang paling bener versi ade, biar keliatan seberapa hafal sama momen kita." },
    PAGE_16: { TITLE: "Doa & Harapan Tahun Ini", PRAYER: "semoga ade makin sehat, hati tenang, sekolah lancar, rezeki deras, jualan laris. apa pun yang ade kejar, mas dukung penuh. langkah ade dimudahkan, doa-doa baiknya satu-satu dikabulkan." },
    PAGE_17: { TITLE: "janji kecil ke adee:", PROMISES: [
      "pas nge-date lebih fokus ke tangan ade, bukan gigi",
      "tiap hari bilang ade cantik/ayu",
      "mau diajakin jajaan",
      "sama ade sampe kapanpun" ] 
    },
    PAGE_18: { 
        TITLE: "make a wish ✨",
        COPY: "tutup mata dulu, bisikkan doa ade yang paling tulus.<br><br>udah? sekarang swipe ke atas unuk tiup lilinnya 🎂<br>mas yang aminin semua doa ade 🤍" 
    },
    PAGE_19: { COPY: "terima kasih sudah jadi rumah ternyaman buat mas." },
    PAGE_20: { CLOSING: "dibuat dengan ❤️ oleh mas aren. kalau ade mau simpan, tekan tombol di bawah." },

    // === REVISI: START ===
    // Kuis (5 Pertanyaan dengan Jawaban Benar)
    PERTANYAAN_KUIS: [
      { q:"film yang pertama kita nonton bareng?", a:["pengeepungan bukit duri", "sebelum maghrib", "13 bom di jakarta"], correct: 2 },
      { q:"tempat pertama kita maem bareng?", a:["depot tanjung api", "watu uleg", "kodam"], correct: 1 },
      { q:"Kita pertama chatan hari apa?", a:["rabu", "kamis", "jumat"], correct: 0 },
      { q:"kapan pertama kita vc?", a:["sebelum first meet", "setelah first meet", "setelah lebaran"], correct: 1 },
      { q:"ade paling suka diapain?", a:["dikasih pujian", "dimarahi", "dicuekin"], correct: 0 }
    ],
    // Hasil Kuis Berdasarkan Skor
    HASIL_KUIS_SKOR: {
      tinggi: { // 4-5 Benar
        title: "Ingatan Ade Sempurna! 😭🤍",
        desc: "Mas beneran terharu, de. Kamu inget semua detail kecil perjalanan kita. Ini bukti kalo setiap momen sama mas itu berarti buat ade. Makasih ya udah jadi partner memori terbaik. Peluk jauuh!"
      },
      sedang: { // 2-3 Benar
        title: "Hehe, Kita Tim yang Hebat! ❤️",
        desc: "Beberapa ada yang kelupaan dikit yaa? Gapapa, sayang! Itu artinya kita masih harus bikin banyaak lagi kenangan baru biar makin nempel di ingatan. Yang penting, kita udah lewatin semuanya bareng."
      },
      rendah: { // 0-1 Benar
        title: "Waktunya Bikin Memori Baru! ✨",
        desc: "Lupa sama detailnya? Justru ini seru! Artinya, petualangan kita masih panjang dan banyak halaman kosong yang harus kita isi bareng-bareng. Mas siap nemenin ade bikin cerita baru, setiap hari."
      }
    },
    // === REVISI: END ===
  };

  const $ = (s)=>document.querySelector(s);
  const $$ = (s)=>[...document.querySelectorAll(s)];
  const T = APP_CONFIG;

  // Header & Footer
  $('#whoTag').textContent = T.NAMA_PENERIMA;
  $('#fromName').textContent = T.NAMA_PENGIRIM;
  $('#emoji').textContent = '💖';

  // Paging
  const FIRST_PAGE = 1, LAST_PAGE = 20; // 1..20 sesuai brief
  let page = Number(localStorage.getItem('__page_index')||FIRST_PAGE);
  let answers = JSON.parse(localStorage.getItem('__quiz_answers')||'[null,null,null,null,null]');

  const prevBtn = $('#prevBtn'), nextBtn = $('#nextBtn'), pageCount = $('#pageCount');
  const prog = $('#prog');

  function setPage(n){ page=n; localStorage.setItem('__page_index', String(page)); updateNav(); }

  function updateNav(){
    prevBtn.disabled = page <= FIRST_PAGE;
    nextBtn.disabled = page >= LAST_PAGE;
    pageCount.textContent = `${page}/${LAST_PAGE}`;
    prog.style.width = ((page-FIRST_PAGE)/(LAST_PAGE-FIRST_PAGE)*100).toFixed(2)+'%';
  }
  prevBtn.addEventListener('click', ()=>{ if(page>FIRST_PAGE){ setPage(page-1); renderPage('slide'); }});
  nextBtn.addEventListener('click', ()=>{ if(page<LAST_PAGE){ setPage(page+1); renderPage('slide'); }});
  window.addEventListener('keydown', e=>{
    if(e.key==='ArrowRight' && page<LAST_PAGE){ setPage(page+1); renderPage('slide'); }
    if(e.key==='ArrowLeft' && page>FIRST_PAGE){ setPage(page-1); renderPage('slide'); }
  });
  // swipe
  (function swipe(){
    let sx=null, sy=null; const el=$('.stage');
    el.addEventListener('touchstart', e=>{ sx=e.touches[0].clientX; sy=e.touches[0].clientY; }, {passive:true});
    el.addEventListener('touchend', e=>{
      if(sx==null) return; const dx=e.changedTouches[0].clientX-sx; const dy=e.changedTouches[0].clientY-sy; sx=sy=null;
      if(Math.abs(dx)>50 && Math.abs(dx)>Math.abs(dy)){
        if(dx<0 && page<LAST_PAGE){ setPage(page+1); renderPage('slide'); }
        if(dx>0 && page>FIRST_PAGE){ setPage(page-1); renderPage('slide'); }
      }
    });
  })();

  // Lightbox
  const lb = $('#lightbox');
  $('#lbClose').addEventListener('click', ()=>lb.classList.remove('open'));
  lb.addEventListener('click', e=>{ if(e.target.id==='lightbox') lb.classList.remove('open'); });
  function openLightbox(src){ $('#lbImg').src=src; lb.classList.add('open'); $('#lbClose').focus(); }

  // Audio
  const bgm = $('#bgm');
  const musicBtn = $('#musicBtn');
  bgm.src = T.BGM_SRC; bgm.volume = .35;
  let musicReady=false, musicPlaying=false;
  bgm.addEventListener('canplay', ()=>{ musicReady=true; musicBtn.style.display='block'; });
  function playMusic(){ if(!musicReady) return; bgm.play().then(()=>{ musicPlaying=true; musicBtn.textContent='🎵'; }).catch(()=>{}); }
  function pauseMusic(){ try{ bgm.pause(); musicPlaying=false; musicBtn.textContent='🔇'; }catch{} }
  musicBtn.addEventListener('click', ()=>{ if(bgm.paused) playMusic(); else pauseMusic(); });
  function autoMusicGuard(){ // auto-pause saat kuis (9..15)
    if(page>=9 && page<=15) pauseMusic();
  }

  // Confetti
  function confettiBurst(count=120){
    if(window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
    const layer=$('#confetti'); const colors=['#ff6b81','#ffd166','#06d6a0','#118ab2','#ef476f'];
    for(let i=0;i<count;i++){
      const p=document.createElement('i');
      Object.assign(p.style,{position:'absolute',top:'-16px',left:(Math.random()*100)+'vw',width:'9px',height:'14px',opacity:.95,borderRadius:'2px',background:colors[i%colors.length],transform:`translateY(0) rotate(${Math.random()*360}deg)`,animation:`fall ${0.9+Math.random()*1.8}s linear forwards`});
      layer.appendChild(p); setTimeout(()=>p.remove(), 2600);
    }
  }
  const styleAnim=document.createElement('style'); styleAnim.textContent='@keyframes fall{to{transform:translateY(110vh) rotate(720deg);opacity:.98}}'; document.head.appendChild(styleAnim);

  // Helpers
  function setContent(html, anim){ const p=$('#page'); p.classList.remove('fade','slide'); p.innerHTML = html; if(anim) p.classList.add(anim); }
  function typewriter(el, text, speed=26){ el.textContent=''; let i=0; const iv=setInterval(()=>{ el.textContent = text.slice(0, ++i); if(i>=text.length) clearInterval(iv); }, speed); }

  // Prefetch asset berikutnya (jaga jank)
  function prefetch(src){ if(!src) return; const l=document.createElement('link'); l.rel='prefetch'; l.as='image'; l.href=src; document.head.appendChild(l); }

  // ============== RENDER HALAMAN ==============
  function render1(){ // Cover
    setContent(`
      <div class="cover-bg" style="background-image:url(${T.FOTO_1_COVER})"></div>
      <div class="cover-overlay"></div>
      <div class="content-center">
        <div class="cover-content">
          <h2>${T.PAGE_01.TITLE}</h2>
          <p>${T.PAGE_01.COPY}</p>
          <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
            <button class="btn" id="startBtn">Mulai</button>
            <button class="btn ghost" id="resumeBtn" style="display:${page>1?'inline-grid':'none'}">Lanjutkan</button>
            <button class="btn ghost" id="musicCtl">Play BGM</button>
          </div>
          <div class="tap muted" style="margin-top:6px">tap to start · fade in</div>
        </div>
      </div>`, 'fade');
    $('#startBtn').addEventListener('click', ()=>{ setPage(2); renderPage('slide'); confettiBurst(120); playMusic(); });
    $('#resumeBtn').addEventListener('click', ()=>{ renderPage('slide'); playMusic(); });
    $('#musicCtl').addEventListener('click', ()=>{ if(!musicPlaying) playMusic(); else pauseMusic(); });
    prefetch(T.FOTO_2_KOLASE);
  }

  function render2(){ // LDR hadir
    setContent(`
      <div style="display:grid;gap:12px;height:100%">
        <div style="margin:auto 0;text-align:center">
          <svg width="100%" viewBox="0 0 600 260" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <defs>
              <linearGradient id="g1" x1="0" x2="0" y1="0" y2="1"><stop stop-color="#ffd3e2"/><stop offset="1" stop-color="#fffafc"/></linearGradient>
            </defs>
            <rect x="0" y="0" width="600" height="260" rx="18" fill="url(#g1)"/>
            <path d="M60 180 C200 120 400 220 540 160" stroke="#ff6b81" stroke-width="3" stroke-dasharray="6 8"/>
            <circle cx="80" cy="180" r="8" fill="#ff6b81"/>
            <circle cx="520" cy="160" r="8" fill="#ff6b81"/>
            <text x="80" y="205" font-size="14" fill="#2a2a2a" text-anchor="middle">pati</text>
            <text x="520" y="145" font-size="14" fill="#2a2a2a" text-anchor="middle">krian</text>
          </svg>
          <h1>jauh di peta, deket di rasa</h1>
          <p class="muted">${T.PAGE_02.COPY}</p>
        </div>
      </div>`, 'fade');
    prefetch(T.FOTO_2_KOLASE);
  }

  function render3(){ // Kolase HBD + parallax overlay
    setContent(`
      <div class="fullimg"><img id="p3img" src="${T.FOTO_2_KOLASE}" alt="kolase HBD" loading="lazy" decoding="async" sizes="(max-width: 720px) 90vw, 720px"></div>
      <div class="content-center" id="p3ov" style="position:absolute; inset:auto 0 0 0; pointer-events:none; background:linear-gradient(180deg, transparent, rgba(255,250,252,.6))"><div><h1>Happy Birthday</h1><p class="muted">${T.PAGE_03.COPY}</p></div></div>
    `, 'fade');
    const ov=$('#p3ov'); const img=$('#p3img');
    const onMove= e=>{ const r=img.getBoundingClientRect(); const cx=(e.clientX||r.left+r.width/2)-r.left; const dx=(cx/r.width-.5)*8; ov.style.transform=`translateX(${dx}px)`; };
    window.addEventListener('pointermove', onMove, {passive:true});
    render3.cleanup=()=>window.removeEventListener('pointermove', onMove);
    prefetch(T.FOTO_3_GALERI);
  }

  function render4(){ // Alasan
    setContent(`
      <div class="content-stack">
        <h2 class="muted">${T.PAGE_04.TITLE}</h2>
        <div id="cards" style="display:grid;gap:10px;">
          ${T.PAGE_04.REASONS.map((x,i)=>`<div class="reason-card" style="animation-delay:${i*0.1}s"><p>${x.replace(/<strong>/g,'<b>').replace(/<\/strong>/g,'</b>')}</p></div>`).join('')}
        </div>
      </div>
    `, 'fade');
  }

  function render5(){ // Galeri (tap to zoom)
    setContent(`<div class="fullimg"><img id="gimg" src="${T.FOTO_3_GALERI}" alt="galeri ade" loading="lazy" decoding="async" style="cursor:zoom-in"></div><p class="muted" style="position:absolute;bottom:10px;left:14px">${T.PAGE_05.COPY}</p>`, 'fade');
    $('#gimg').addEventListener('click', ()=>openLightbox(T.FOTO_3_GALERI));
    prefetch(T.FOTO_4_SURAT);
  }

  function render6(){ // Surat (download + zoom)
    setContent(`
      <div class="content-center" style="gap:12px;">
        <img id="letterImg" src="${T.FOTO_4_SURAT}" alt="surat" style="max-width:100%;max-height:78%;border-radius:14px;box-shadow:0 8px 30px rgba(0,0,0,.18); transform:scale(.98); opacity:0">
        <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center">
          <button class="btn" id="dlSurat">Download Surat</button>
          <button class="btn ghost" id="zoomSurat">Zoom</button>
        </div>
      </div>
    `, 'fade');
    const img=$('#letterImg'); setTimeout(()=>{ img.style.transition='all .5s ease'; img.style.opacity='1'; img.style.transform='scale(1)'; }, 30);
    $('#dlSurat').addEventListener('click', ()=>{ const a=document.createElement('a'); a.href=T.FOTO_4_SURAT; a.download='surat-ulang-tahun.jpg'; a.click(); });
    $('#zoomSurat').addEventListener('click', ()=>openLightbox(T.FOTO_4_SURAT));
  }

  function render7(){ // Hadiah
    setContent(`
      <div class="content-stack">
        <h2>${T.PAGE_07.TITLE}</h2>
        <div style="display:grid;gap:12px;width:90%;max-width:560px;margin:0 auto">
          ${T.PAGE_07.GIFTS.map(g=>`<div class="gift-card"><h3 style="margin:0 0 4px 0">${g.icon} ${g.title}</h3><p class="muted" style="margin:0">${g.desc}</p></div>`).join('')}
        </div>
        <p class="muted">${T.PAGE_07.CLOSING}</p>
      </div>
    `, 'fade');
  }

  function render8(){ // Checklist (autosave)
    setContent(`
      <div class="content-stack">
        <h2>${T.PAGE_08.TITLE}</h2>
        <ul class="checklist" id="cl"></ul>
      </div>
    `, 'fade');
    const wrap=$('#cl'); const key='__plans'; const saved=JSON.parse(localStorage.getItem(key)||'{}');
    T.PAGE_08.PLANS.forEach((txt,i)=>{
      const id='p'+i; const li=document.createElement('li'); li.innerHTML=`<input id="${id}" type="checkbox" ${saved[id]?'checked':''}> <label for="${id}">${txt}</label>`; wrap.appendChild(li);
      li.querySelector('input').addEventListener('change',e=>{ saved[id]=e.target.checked; localStorage.setItem(key, JSON.stringify(saved)); });
    });
  }

  function render9(){ // Kuis intro
    setContent(`
      <div class="content-center"><div><h2 class="muted">💌 kuis nostalgia</h2><h1>${"“coba kita flashback dikit yuk 🥰"}</h1><p class="muted">${"pilih jawaban yang paling bener versi ade, biar keliatan seberapa hafal sama momen kita.”"}</p><button class="btn" id="mulaiKuis" style="margin-top:10px">let’s gooo</button></div></div>
    `, 'fade');
    $('#mulaiKuis').addEventListener('click', ()=>{ setPage(10); renderPage('slide'); });
  }

  // === REVISI: START ===
  function renderQuiz(qIndex){
    const data=T.PERTANYAAN_KUIS[qIndex];
    setContent(`
      <div class="quiz">
        <div><h2>Kuis ${qIndex+1}/5</h2><h1 style="margin-top:6px">${data.q}</h1></div>
        <div class="choices" id="choices">${data.a.map((opt, i)=>`<button class="choice" data-index="${i}">${opt}</button>`).join('')}</div>
      </div>
    `, 'fade');
    $$('.choice').forEach(b=>{
      b.addEventListener('click', ()=>{
        const chosenIndex = parseInt(b.dataset.index);
        answers[qIndex] = chosenIndex;
        localStorage.setItem('__quiz_answers', JSON.stringify(answers));
        
        // Menampilkan feedback benar/salah secara visual
        $$('.choice').forEach((btn, index) => {
          btn.disabled = true;
          if (index === data.correct) {
            btn.classList.add('correct');
          } else if (index === chosenIndex) {
            btn.classList.add('wrong');
          }
        });

        setTimeout(()=>{ if(page<LAST_PAGE){ setPage(page+1); renderPage('slide'); } }, 800); // Waktu jeda agar bisa lihat feedback
      });
    });
  }

  function render15(){ // Hasil kuis
    let score = 0;
    for (let i = 0; i < T.PERTANYAAN_KUIS.length; i++) {
        if (answers[i] === T.PERTANYAAN_KUIS[i].correct) {
            score++;
        }
    }

    let result;
    if (score >= 4) {
        result = T.HASIL_KUIS_SKOR.tinggi;
        confettiBurst(150); // Apresiasi lebih dengan confetti
    } else if (score >= 2) {
        result = T.HASIL_KUIS_SKOR.sedang;
    } else {
        result = T.HASIL_KUIS_SKOR.rendah;
    }
    
    setContent(`
      <div class="content-center"><div>
        <h2 class="muted">Hasil Kuis Kenangan Kita:</h2>
        <h1>${result.title}</h1>
        <p>${result.desc}</p>
        <p style="margin-top:12px; font-weight:bold;">Skor Ade: ${score} / 5</p>
        <button class="btn" id="hug" style="margin-top:12px">Apapun Hasilnya, Sini Peluk Dulu 🤍</button>
      </div></div>
    `, 'fade');
    $('#hug').addEventListener('click', ()=>{ 
        confettiBurst(140); 
        const b=$('#hug'); 
        b.style.transform='scale(1.06)'; 
        setTimeout(()=>b.style.transform='scale(1)',120); 
    });
  }
  // === REVISI: END ===

  function render16(){ // Doa & Harapan
    setContent(`<div class="content-center"><div><h2>${T.PAGE_16.TITLE}</h2><p id="doa" class="muted" style="max-width:92%;margin:6px auto 0"></p></div></div>`, 'fade');
    typewriter($('#doa'), T.PAGE_16.PRAYER);
  }

  function render17(){ // Janji kecil
    setContent(`<div class="content-stack"><h2>${T.PAGE_17.TITLE}</h2><ul class="checklist">${T.PAGE_17.PROMISES.map(x=>`<li><input type="checkbox" checked disabled><span>${x}</span></li>`).join('')}</ul><p class="muted">janji ini emang sederhana, tapi mas serius ngejaganyaa</p></div>`, 'fade');
  }

  function render18(){ // Blow the candle (swipe up)
    setContent(`
      <div class="content-center"><div>
        <div class="cake"><div class="body"></div><div class="candle"></div><div class="flame" id="flame"></div></div>
        <h1 style="margin-top:10px">${T.PAGE_18.TITLE}</h1>
        <p class="muted">${T.PAGE_18.COPY}</p>
      </div></div>
    `, 'fade');
    const flame=$('#flame'); let startY=null;
    const onStart=e=>{ startY=(e.touches?e.touches[0].clientY:e.clientY); };
    const onEnd=e=>{ if(startY==null) return; const y=(e.changedTouches?e.changedTouches[0].clientY:e.clientY); if(startY - y > 40){ flame.classList.add('off'); confettiBurst(120);} startY=null; };
    $('#page').addEventListener('pointerdown', onStart, {passive:true});
    $('#page').addEventListener('pointerup', onEnd, {passive:true});
    $('#page').addEventListener('touchstart', onStart, {passive:true});
    $('#page').addEventListener('touchend', onEnd, {passive:true});
  }

  function render19(){ // Kolase penutup (reuse foto2)
    setContent(`<div class="fullimg"><img src="${T.FOTO_2_KOLASE}" alt="penutup" loading="lazy" sizes="(max-width: 720px) 90vw, 720px"></div><p class="muted" style="position:absolute;bottom:10px;left:14px">${T.PAGE_19.COPY}</p>`, 'fade');
  }

  function render20(){ // Credit & CTA
    const wa = `https://wa.me/${T.NOMOR_WA_PENGIRIM}`;
    setContent(`
      <div class="content-center"><div>
        <p>${T.PAGE_20.CLOSING}</p>
        <div style="display:flex; gap:10px; margin-top:16px; justify-content:center; flex-wrap:wrap;">
          <button class="btn ghost" id="dl">Download Surat</button>
          <button class="btn ghost" id="replay">Replay</button>
          <a href="${wa}" target="_blank" class="btn">Chat Mas Sekarang</a>
        </div>
      </div></div>
    `, 'fade');
    $('#dl').addEventListener('click', ()=>{ const a=document.createElement('a'); a.href=T.FOTO_4_SURAT; a.download='surat-ulang-tahun.jpg'; a.click(); });
    $('#replay').addEventListener('click', ()=>{ setPage(1); renderPage('slide'); });
  }

  function renderPage(anim){
    // cleanup hooks
    if(typeof render3.cleanup==='function') render3.cleanup();
    autoMusicGuard();

    switch(page){
      case 1: render1(); break;
      case 2: render2(); break;
      case 3: render3(); break;
      case 4: render4(); break;
      case 5: render5(); break;
      case 6: render6(); break;
      case 7: render7(); break;
      case 8: render8(); break;
      case 9: render9(); break;
      case 10: renderQuiz(0); break;
      case 11: renderQuiz(1); break;
      case 12: renderQuiz(2); break;
      case 13: renderQuiz(3); break;
      case 14: renderQuiz(4); break;
      case 15: render15(); break;
      case 16: render16(); break;
      case 17: render17(); break;
      case 18: render18(); break;
      case 19: render19(); break;
      case 20: render20(); break;
      default: setPage(1); render1();
    }
    updateNav();
  }

  // Init
  renderPage('fade');

  // =======================
  // PWA-lite: cache untuk offline
  // =======================
  (function registerSW(){
    if(!('serviceWorker' in navigator)) return;
    const version='v4.0.0';
    const assets=['.','assets/foto1.jpg','assets/foto2.jpg','assets/foto3.jpg','assets/foto4.jpg'].filter(Boolean);
    const swCode=`
      const CACHE='love_${'${version}'}_'+(Date.now());
      const ASSETS=${'${JSON.stringify(assets)}'};
      self.addEventListener('install',e=>{ e.waitUntil(caches.open(CACHE).then(c=>c.addAll(ASSETS)).then(()=>self.skipWaiting())) });
      self.addEventListener('activate',e=>{ e.waitUntil(caches.keys().then(keys=>Promise.all(keys.filter(k=>k.startsWith('love_') && k!==CACHE).map(k=>caches.delete(k)))).then(()=>self.clients.claim())) });
      self.addEventListener('fetch',e=>{ const req=e.request; if(req.method!=='GET') return; e.respondWith(caches.match(req).then(r=> r || fetch(req).then(res=>{ const copy=res.clone(); caches.open(CACHE).then(c=>{ try{ c.put(req, copy) }catch(e){} }); return res; }).catch(()=>caches.match('./')))) });`;
    const blob=new Blob([swCode],{type:'text/javascript'}); const url=URL.createObjectURL(blob);
    navigator.serviceWorker.register(url).catch(()=>{}); setTimeout(()=>URL.revokeObjectURL(url), 4000);
  })();
  </script>

</body>
</html>
