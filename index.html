<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<title>buat ade ‚Äî scrapbook</title>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="description" content="flipbook scrapbook interaktif untuk ade dari mas.">
<meta property="og:title" content="buat ade ‚Äî scrapbook">
<meta property="og:description" content="flipbook scrapbook interaktif untuk ade dari mas.">
<meta property="og:type" content="website">
<meta property="og:image" content="assets/og.jpg">
<meta name="theme-color" content="#ff6b81">
<link rel="icon" href='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" rx="24" ry="24" fill="%23ff6b81"/><path d="M24 40h80v48c0 4.4-3.6 8-8 8H32c-4.4 0-8-3.6-8-8V40z" fill="%23fff5f7"/><path d="M24 40l40 28 40-28" fill="none" stroke="%23ff6b81" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/></svg>'>
<style>

  .actionsEnd{ margin:18px 0 6px }

  
:root{
  --c-accent:#ff6b81; --c-soft:#ffd3e2; --c-paper:#fff5f7; --c-text:#4d4d4d;
  --shadow:0 10px 28px rgba(0,0,0,.12); --radius:22px; --gap:16px;
  --paper-edge:#e7b8c6;
}
@media(prefers-color-scheme:dark){
  :root{ --c-paper:#1b1b1b; --c-text:#f0f0f0; --c-soft:#2a2224; --paper-edge:#5b3942 }
  body{ background:#121212 }
}
[data-theme="dark"]{ color-scheme:dark }
[data-theme="light"]{ color-scheme:light }
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font:16px/1.65 system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif;
  color:var(--c-text);
  background:
    radial-gradient(1200px 200px at 50% -80px, var(--c-soft), transparent 70%),
    linear-gradient(180deg, var(--c-soft), #ffffff 40%, var(--c-paper));
}
.container{max-width:980px;margin:0 auto;padding:20px}
.toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.tag{display:inline-block;padding:4px 10px;border-radius:999px;background:var(--c-soft);font-size:12px}
.btn{
  appearance:none;border:0;background:var(--c-accent);color:#fff;padding:11px 16px;border-radius:999px;font-weight:700;
  box-shadow:0 8px 20px rgba(255,107,129,.35);cursor:pointer;transition:transform .08s ease, box-shadow .2s;
}
.btn:hover{transform:translateY(-1px)}
.btn:focus-visible{outline:3px solid #0000;box-shadow:0 0 0 3px #fff,0 0 0 6px var(--c-accent)}
.btn.ghost{background:transparent;color:var(--c-accent);border:2px solid var(--c-accent);box-shadow:none}
.btn[disabled]{opacity:.6;cursor:not-allowed}
.center{text-align:center}
.muted{opacity:.78}
.hidden{display:none !important}

/* torn paper frame for page background */
.paper{
  background:var(--c-paper);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  position:relative; overflow:hidden;
}
.paper::before,
.paper::after{
  content:""; position:absolute; left:0; width:100%; height:36px; z-index:1;
  background:
    radial-gradient(22px 18px at 24px 18px, transparent 60%, var(--c-paper) 61%) repeat-x,
    linear-gradient(var(--paper-edge), var(--paper-edge));
  background-size:48px 36px, 100% 2px;
  background-position:0 0, 0 34px;
}
.paper::before{ top:0; transform:scaleY(-1) }
.paper::after{ bottom:0 }

/* COVER */
.cover{min-height:74vh;display:grid;place-items:center;padding:20px}
.bookCard{width:min(500px,92vw);padding:18px}
.bookMock{
  margin:0 auto; width:min(320px,70vw); aspect-ratio:3/4; border-radius:18px; background:linear-gradient(135deg,#fff,var(--c-paper));
  box-shadow:0 14px 28px rgba(0,0,0,.2); position:relative; overflow:hidden;
}
.bookMock::after{ /* spine */
  content:""; position:absolute; left:50%; top:0; width:6px; height:100%; transform:translateX(-50%);
  background:linear-gradient(90deg, transparent, rgba(0,0,0,.08), transparent);
}
.kupu{
  position:absolute; top:-8px; left:10px; width:56px; height:auto; animation:flap 5s ease-in-out infinite;
  opacity:.9
}
@keyframes flap{
  0%,100%{ transform:translateY(0) rotate(-6deg) }
  50%{ transform:translateY(6px) rotate(6deg) }
}

/* BOOK VIEW */
#bookWrap{margin-top:8px}
.book{
  margin:0 auto; width:min(820px,96vw); perspective:1400px;
}
.spread{
  position:relative; display:grid; grid-template-columns:1fr 1fr; gap:0; border-radius:var(--radius); overflow:hidden;
  transform-style:preserve-3d; background:var(--c-paper); box-shadow:var(--shadow);
}
.page{
  min-height:62vh; position:relative; padding:18px; overflow:hidden;
}
.page::after{ /* inner tear edge center */
  content:""; position:absolute; top:0; bottom:0; width:12px; background:linear-gradient(90deg,rgba(0,0,0,.05),transparent);
}
.page.left::after{ right:0 }
.page.right::after{ left:0; transform:scaleX(-1) }
.page.left{ background:linear-gradient(180deg,#fff, var(--c-paper)); }
.page.right{ background:linear-gradient(180deg,#fff, var(--c-paper)); }

/* simple page turn animation */
.book.turning .page.right{ animation:turnR .6s ease forwards }
.book.turning.back .page.left{ animation:turnL .6s ease forwards }
@keyframes turnR{ from{ transform-origin:left center; transform:rotateY(0deg) } to{ transform-origin:left center; transform:rotateY(-92deg) } }
@keyframes turnL{ from{ transform-origin:right center; transform:rotateY(0deg) } to{ transform-origin:right center; transform:rotateY(92deg) } }

/* SCRAP COMPONENTS */
.polaroid{background:#fff;border-radius:12px;padding:8px;box-shadow:0 10px 22px rgba(0,0,0,.18)}
.polaroid img{display:block;width:100%;height:auto;border-radius:8px;object-fit:cover;aspect-ratio:4/3}
.tape{
  position:absolute; width:70px; height:26px; background:linear-gradient(180deg,#ffdbe6,#ffbdce);
  box-shadow:0 6px 10px rgba(0,0,0,.15); border-radius:4px; transform:rotate(var(--rot,0deg));
  mix-blend:multiply; opacity:.85;
}
.stamp{position:absolute; right:12px; bottom:12px; font-size:12px; padding:6px 10px; border:1px dashed rgba(0,0,0,.25); border-radius:8px; background:#fff8}

/* gallery */
.grid{ display:grid; gap:12px }
.grid.col2{ grid-template-columns:1fr 1fr }
.grid.col3{ grid-template-columns:1fr 1fr 1fr }
@media(max-width:720px){ .grid.col3{ grid-template-columns:1fr 1fr } }

/* controls */
.bookNav{display:flex;justify-content:center;align-items:center;gap:12px;margin:14px 0 6px}
.pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:var(--c-soft);font-weight:600}
.indicator{font-size:13px}

/* quiz */
.quizQ{font-weight:700;margin:8px 0 6px}
.progress{height:10px;background:rgba(0,0,0,.08);border-radius:999px;overflow:hidden}
.progress>i{display:block;height:100%;width:0%;background:var(--c-accent)}
.choices{display:grid;gap:8px;margin-top:8px}
.choice{padding:10px 12px;border:1px solid rgba(0,0,0,.12);border-radius:10px;background:#fff0;cursor:pointer}
.choice.correct{border-color:rgba(0,160,0,.6)}
.choice.wrong{border-color:rgba(220,0,0,.6)}

/* sticker mode */
#stickerPanel{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.sticker{position:absolute; touch-action:none; user-select:none; cursor:grab; transform-origin:center center; transition:box-shadow .2s}
.sticker:active{cursor:grabbing; box-shadow:0 8px 18px rgba(0,0,0,.25)}
.sticker svg{width:64px;height:64px}
#stickerBtns{display:flex;gap:8px}
.slabel{font-size:13px}

/* modal message */
.modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.6); z-index:1200}
.modal.open{display:flex}
.modalCard{ background:var(--c-paper); width:min(560px,92vw); border-radius:16px; box-shadow:var(--shadow); padding:16px }
.modalCard textarea{ width:100%; min-height:120px; border-radius:12px; border:1px solid rgba(0,0,0,.18); padding:10px; background:transparent; color:inherit }
.msgList{ margin-top:10px; max-height:40vh; overflow:auto; display:grid; gap:8px }
.msgItem{ background:#fff6; border:1px dashed rgba(0,0,0,.2); padding:10px; border-radius:12px }

/* lightbox */
#lightbox{position:fixed;inset:0;background:rgba(0,0,0,.88);display:none;align-items:center;justify-content:center;z-index:1100}
#lightbox.open{display:flex}
#lightbox img{max-width:92vw;max-height:86vh;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.6)}

/* butterfly floating decor */
#butterFloat{position:fixed; top:14px; right:18px; z-index:100; opacity:.85; pointer-events:none; }
#butterFloat svg{width:46px; height:46px; animation:flap 6s ease-in-out infinite}

/* print */
@media print{
  body{ background:#fff }
  .toolbar, .bookNav, #stickerPanel, #butterFloat, #controlsBar, #lightbox, #messageModal{ display:none !important }
  .cover{ display:none }
  .page{ min-height:auto }
  .spread{ box-shadow:none; break-inside:avoid; margin:0 0 14mm }
}

/* accessibility */
.skip{ position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden }
.skip:focus{ position:static; width:auto; height:auto; background:var(--c-soft); padding:8px 12px; border-radius:999px }
</style>
</head>
<body>
<a class="skip" href="#bookWrap">Lewati ke isi</a>

<div id="butterFloat" aria-hidden="true">
  <!-- butterfly svg -->
  <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M18 30c-8 0-14-10-10-16 6-8 18 2 20 7-1-6 4-13 10-12 6 1 10 10 6 16" fill="#ffb3c4"/>
    <path d="M46 30c8 0 14-10 10-16-6-8-18 2-20 7 1-6-4-13-10-12-6 1-10 10-6 16" fill="#ffa0b6"/>
    <rect x="30" y="28" width="4" height="14" rx="2" fill="#6d2a3a"/>
  </svg>
</div>

<div class="container">
  <header class="toolbar" aria-label="toolbar">
  <span class="tag" id="whoTag"></span>
  <button class="btn ghost" id="musicBtn" aria-label="putar musik" disabled>putar musik</button>
  <div style="margin-left:auto;display:flex;align-items:center;gap:10px" id="controlsBar">
    <span class="tag">tema</span>
    <label class="tag" style="display:inline-flex;align-items:center;gap:6px">
      <input id="themeToggle" type="checkbox" aria-label="toggle tema">
      <span id="themeLabel">gelap</span>
    </label>
  </div>
</header>


  <!-- COVER -->
  <section id="cover" class="cover">
    <div class="paper bookCard center">
      <div class="bookMock">
        <img class="kupu" alt="kupu-kupu" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 40"><path d="M10 20c-6 0-10-7-7-12 4-6 13 1 14 5-1-4 3-10 7-9 4 1 7 7 4 12" fill="%23ffb3c4"/><path d="M50 20c6 0 10-7 7-12-4-6-13 1-14 5 1-4-3-10-7-9-4 1-7 7-4 12" fill="%23ffa0b6"/><rect x="28" y="18" width="4" height="10" rx="2" fill="%236d2a3a"/></svg>'>
      </div>
      <h1 id="coverTitle" style="margin:14px 0 6px 0"></h1>
      <p id="coverTag" class="muted" style="margin:0 0 12px 0"></p>
      <button class="btn" id="openBtn" aria-label="buka buku">Open</button>
    </div>
  </section>

  <!-- BOOK -->
  <section id="bookWrap" class="hidden" aria-label="flipbook">
    <div class="book" id="book">
      <div class="spread paper" id="spread">
        <div class="page left" id="pageL"></div>
        <div class="page right" id="pageR"></div>
      </div>
    </div>

    <div class="bookNav" aria-label="navigasi halaman">
      <button class="btn ghost" id="prevBtn" aria-label="halaman sebelumnya">‚Üê</button>
      <span class="pill"><span class="indicator" id="pageIndicator">1/1</span></span>
      <button class="btn ghost" id="nextBtn" aria-label="halaman selanjutnya">‚Üí</button>
      <button class="btn ghost" id="stickerToggle" title="mode stiker">+ stiker</button>
      <button class="btn ghost" id="printBtn" title="print/pdf">print</button>
    </div>

    <div id="stickerPanel" class="hidden" aria-label="panel stiker">
      <span class="slabel muted">tarik stiker ke halaman ‚Ä¢ double-tap untuk rotasi ‚Ä¢ simpan otomatis</span>
      <div id="stickerBtns">
        <button class="btn ghost" data-stk="heart">‚ù§</button>
        <button class="btn ghost" data-stk="tape">pita</button>
        <button class="btn ghost" data-stk="butter">kupu</button>
        <button class="btn" id="clearStickers">bersihkan</button>
      </div>
    </div>
  </section>

  <section class="actionsEnd center" aria-label="aksi akhir halaman">
  <div class="toolbar" style="justify-content:center">
    <button class="btn" id="shareBtn" aria-label="bagikan via whatsapp">bagikan</button>
    <button class="btn ghost" id="openMsg" aria-label="kirim pesan">kirim pesan</button>
  </div>
</section>

  
  <footer class="center muted" style="margin-top:10px">dibuat dengan <span id="emoji">üíñ</span> oleh <span id="fromName"></span></footer>
</div>

<!-- Lightbox -->
<div id="lightbox" role="dialog" aria-modal="true" aria-label="pratinjau gambar">
  <img id="lbImg" alt="gambar">
</div>

<!-- Modal Pesan -->
<div class="modal" id="messageModal" role="dialog" aria-modal="true" aria-label="kirim pesan">
  <div class="modalCard">
    <h3 id="msgTitle" style="margin:0 0 8px 0">tulis pesan</h3>
    <textarea id="msgText" placeholder="ketik pesan manis di sini‚Ä¶"></textarea>
    <div class="toolbar" style="margin-top:8px">
      <button class="btn" id="sendMsg">kirim</button>
      <button class="btn ghost" id="closeMsg">tutup</button>
      <button class="btn ghost" id="viewMsgs">lihat pesan masuk</button>
    </div>
    <div class="msgList hidden" id="msgList"></div>
  </div>
</div>

<audio id="bgm" preload="none"></audio>
<audio id="flipSfx" preload="none"></audio>

<script>
/* =======================
   APP CONFIG (editable)
   ======================= */
window.APP_CONFIG = {
  NAMA_PENERIMA: "Aina Septitsany Athiya Ramadhani",
  NAMA_PENGIRIM: "mas aren",
  PALETA_WARNA: ["#ff6b81","#ffd3e2","#fff5f7","#4d4d4d"],
  FONT_STACK: "system-ui, -apple-system, Segoe UI, Roboto, Inter, sans-serif",
  KALIMAT_PEMBUKA: "hai ade, ada sesuatu buat kamu üíå",
  PESAN_SAMPUL: "happy special day",
  PESAN_TAGLINE: "semoga semua yang baik dipercepat untuk kita.",
  SPREADS: [
    {"jenis":"foto+quote","judul":"special forever","quote":"yang sederhana tapi konsisten, itu yang bikin kita kuat.","gambar":["assets/foto1.jpg","assets/foto2.jpg"]},
    {"jenis":"foto+note","judul":"happy birthday","note":"semoga semesta berpihak sama kamu. semoga semua yang kamu perjuangkan mendekat. aku di sini.","gambar":["assets/foto3.jpg"]},
    {"jenis":"kolase","judul":"me and you","caption":"i love you on your birthday, and everyday. now and forever.","gambar":["assets/foto1.jpg","assets/foto4.jpg","assets/foto5.jpg"]},
    {"jenis":"surat","judul":"surat kecil","surat_markdown":"ade,\\n\\nterima kasih sudah jadi tempat pulang paling tenang buat aku. kalau dunia lagi bising, kamu selalu bikin pelan.\\n\\naku janji hal-hal kecil tapi konsisten: kabarin pulang, pegang tangan waktu nyebrang, dengerin sampai selesai. semoga kamu selalu merasa dicintai dan dilihat‚Äîsetiap hari.\\n\\npelan-pelan, tapi pasti. bareng, ya."},
    {"jenis":"galeri","judul":"special memories","gambar":["assets/foto2.jpg","assets/foto3.jpg","assets/foto6.jpg","assets/foto7.jpg"]}
  ],
  KUIS: [
    {"q":"first date paling kita inget di mana?","a":["taman kota","kfc","stasiun"],"correct":1},
    {"q":"minuman favorit kamu?","a":["matcha","kopi susu","thai tea"],"correct":0},
    {"q":"lagu yang sering kita dengerin bareng?","a":["blue hour","daylight","perfect"],"correct":2},
    {"q":"kucing idaman kita?","a":["scottish fold","anggora","british shorthair"],"correct":2},
    {"q":"kapan kita mulai intens chat?","a":["okt 2024","jan 2025","mar 2025"],"correct":1}
  ],
  PESAN_MODAL_TITLE: "tulis pesan untuk mas",
  PESAN_PLACEHOLDER: "ketik pesan manis di sini‚Ä¶",
  PESAN_BUTTON: "kirim",
  WA_TARGET: "",
  MUSIK_LATAR: "assets/love.mp3",
  CTA_WHATSAPP: "https://wa.me/?text=",
  FALLBACK_EMOJI: "üíñ",
  LOKALE: "id-ID",
  SEO_TITLE: "buat ade ‚Äî scrapbook",
  SEO_DESC: "flipbook scrapbook interaktif untuk ade dari mas.",
  OG_IMAGE: "assets/og.jpg"
};

/* =======================
   INIT THEME & META
======================= */
const root=document.documentElement;
(function applyTheme(){
  const pal=APP_CONFIG.PALETA_WARNA;
  if(pal){ root.style.setProperty('--c-accent',pal[0]);root.style.setProperty('--c-soft',pal[1]);root.style.setProperty('--c-paper',pal[2]);root.style.setProperty('--c-text',pal[3]); }
  document.body.style.fontFamily=APP_CONFIG.FONT_STACK;
  document.title=APP_CONFIG.SEO_TITLE||document.title;
  document.querySelector('meta[name="description"]').setAttribute('content',APP_CONFIG.SEO_DESC||"");
  if(APP_CONFIG.OG_IMAGE){ document.querySelector('meta[property="og:image"]').setAttribute('content',APP_CONFIG.OG_IMAGE); }
})();

/* helpers */
const $=s=>document.querySelector(s); const $$=s=>[...document.querySelectorAll(s)];
function el(tag,attrs={},html=""){ const e=document.createElement(tag); for(const k in attrs){ if(k==='class') e.className=attrs[k]; else e.setAttribute(k,attrs[k]); } if(html) e.innerHTML=html; return e; }
function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]); }
function mdToHtml(md){
  return md.split('\\n\\n').map(b=>"<p>"+b.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").split('\\n').map(escapeHtml).join("<br>")+"</p>").join("");
}

/* header text */
$('#whoTag').textContent = APP_CONFIG.NAMA_PENERIMA;
$('#fromName').textContent = APP_CONFIG.NAMA_PENGIRIM;
$('#emoji').textContent = APP_CONFIG.FALLBACK_EMOJI||'üíñ';

/* theme toggle */
(function themeToggle(){
  const key='__theme'; const saved=localStorage.getItem(key);
  const prefersDark=matchMedia('(prefers-color-scheme: dark)').matches;
  const mode=saved || (prefersDark?'dark':'light');
  document.documentElement.setAttribute('data-theme',mode);
  $('#themeToggle').checked=(mode==='dark');
  $('#themeLabel').textContent = mode==='dark'?'gelap':'terang';
  $('#themeToggle').addEventListener('change',()=>{
    const m=$('#themeToggle').checked?'dark':'light';
    document.documentElement.setAttribute('data-theme',m); localStorage.setItem(key,m);
    $('#themeLabel').textContent = m==='dark'?'gelap':'terang';
  });
})();

/* COVER */
$('#coverTitle').textContent = APP_CONFIG.PESAN_SAMPUL;
$('#coverTag').textContent = APP_CONFIG.PESAN_TAGLINE;
$('#openBtn').addEventListener('click', ()=>{
  $('#cover').classList.add('hidden'); $('#bookWrap').classList.remove('hidden'); playFlip();
});

/* SHARE + MUSIC */
$('#shareBtn').addEventListener('click', ()=>{
  const text=`hai ${APP_CONFIG.NAMA_PENERIMA}, buka web ini ya: ${location.href}\\n\\n${APP_CONFIG.PESAN_TAGLINE}`;
  location.href = APP_CONFIG.CTA_WHATSAPP + encodeURIComponent(text);
});
const bgm=$('#bgm'); const sfx=$('#flipSfx'); const musicBtn=$('#musicBtn');
if(APP_CONFIG.MUSIK_LATAR){ bgm.src=APP_CONFIG.MUSIK_LATAR; bgm.volume=.4; bgm.addEventListener('canplay',()=>musicBtn.disabled=false); bgm.addEventListener('error',()=>musicBtn.disabled=true); }
musicBtn.addEventListener('click', async ()=>{ try{ if(bgm.paused){ await bgm.play(); musicBtn.textContent='jeda musik'; } else { bgm.pause(); musicBtn.textContent='putar musik'; } }catch{} });
sfx.src='assets/flip.mp3'; sfx.volume=.5; sfx.addEventListener('error',()=>{ /* optional */ });

/* BOOK / SPREAD RENDER */
const spreads = APP_CONFIG.SPREADS.slice();
spreads.splice(2,0, {jenis:'kuis', judul:'kuis kecil'}); // selipkan kuis di spread ke-3

let cur=0;
function updateIndicator(){ $('#pageIndicator').textContent = (cur+1)+'/'+spreads.length; }
function playFlip(){ try{sfx.currentTime=0; sfx.play();}catch{} }

const pageL=$('#pageL'), pageR=$('#pageR'), book=$('#book');
function renderSpread(i){
  const data=spreads[i]||{};
  pageL.innerHTML=''; pageR.innerHTML='';
  // title stamps
  const stampL = el('div',{class:'stamp'}, escapeHtml(data.judul||'')); pageL.appendChild(stampL);

  if(data.jenis==='foto+quote'){
    // Left: two polaroids stacked
    const wrap=el('div',{class:'grid col1'}); wrap.style.display='grid'; wrap.style.gap='12px';
    (data.gambar||[]).slice(0,2).forEach((src,k)=>{
      const fig=el('figure',{class:'polaroid'});
      const img=el('img',{alt:'momen '+(k+1)}); img.src=src||placeholder(); img.loading='lazy'; img.decoding='async';
      img.addEventListener('click',()=>openLightbox(img.src));
      fig.appendChild(img); wrap.appendChild(fig);
    });
    pageL.appendChild(wrap);
    decorateTape(pageL);

    // Right: quote big + image
    const q=el('div',{}, `<h2 style="margin:6px 0 10px 0">${escapeHtml(data.judul||'')}</h2><p style="font-size:18px">${escapeHtml(data.quote||'')}</p>`);
    pageR.appendChild(q);
    const fig=el('figure',{class:'polaroid',style:'position:absolute;right:12px;bottom:18px;width:min(46%,260px)'}); 
    const img=el('img',{src:(data.gambar||[])[0]||placeholder(), alt:'foto'}); img.addEventListener('click',()=>openLightbox(img.src));
    fig.appendChild(img); pageR.appendChild(fig);
  }

  else if(data.jenis==='foto+note'){
    const fig=el('figure',{class:'polaroid',style:'width:86%;margin-top:6px'}); 
    const img=el('img',{src:(data.gambar||[])[0]||placeholder(), alt:'foto'}); img.addEventListener('click',()=>openLightbox(img.src));
    fig.appendChild(img); pageL.appendChild(fig);
    decorateTape(pageL);
    const note=el('div',{class:'paper',style:'padding:12px;margin:8px 0 0 0'}, `<h2 style="margin:0 0 6px 0">${escapeHtml(data.judul||'')}</h2><p>${escapeHtml(data.note||'')}</p>`);
    pageR.appendChild(note);
  }

  else if(data.jenis==='kolase'){
    const imgs=(data.gambar||[]).slice(0,3);
    const gL=el('div',{class:'grid col2'}); imgs.slice(0,2).forEach((src,k)=>{ const f=el('figure',{class:'polaroid'}); const im=el('img',{src:src||placeholder(),alt:'kolase '+(k+1)}); im.addEventListener('click',()=>openLightbox(im.src)); f.appendChild(im); gL.appendChild(f); }); 
    pageL.appendChild(gL); decorateTape(pageL);
    const big=el('figure',{class:'polaroid',style:'width:94%;margin:6px auto'}); const im=el('img',{src:imgs[2]||imgs[0]||placeholder(),alt:'kolase besar'}); im.addEventListener('click',()=>openLightbox(im.src)); big.appendChild(im); pageR.appendChild(big);
    const cap=el('p',{class:'muted',style:'margin:6px 8px'}, escapeHtml(data.caption||'')); pageR.appendChild(cap);
  }

  else if(data.jenis==='surat'){
    const letter=el('div',{class:'paper',style:'padding:12px'}, `<h2 style="margin:0 0 6px 0">${escapeHtml(data.judul||'')}</h2>${mdToHtml(data.surat_markdown||'')}`);
    pageL.appendChild(letter);
    const deco=el('div',{},'<div class="tape" style="top:16px;left:14px;--rot:-8deg"></div><div class="tape" style="top:18px;right:24px;--rot:12deg"></div>');
    pageR.appendChild(deco);
    const pol=el('figure',{class:'polaroid',style:'width:80%;position:absolute;bottom:20px;right:16px;transform:rotate(-2deg)'}); const im=el('img',{src:placeholder(),alt:'dekor'}); pol.appendChild(im); pageR.appendChild(pol);
  }

  else if(data.jenis==='galeri'){
    const g=el('div',{class:'grid col3'}); (data.gambar||[]).forEach((src,k)=>{ const f=el('figure',{class:'polaroid'}); const im=el('img',{src:src||placeholder(),alt:'galeri '+(k+1)}); im.addEventListener('click',()=>openLightbox(im.src)); f.appendChild(im); g.appendChild(f); });
    pageL.appendChild(el('h2',{},'special memories'));
    pageL.appendChild(g);
    pageR.appendChild(el('p',{class:'muted',style:'margin:8px'},'klik foto untuk memperbesar ‚Ä¢ geser halaman untuk lanjut'));
  }

  else if(data.jenis==='kuis'){
    renderQuiz();
  }

  // restore stickers
  renderStickersFor(i);
}
function decorateTape(parent){
  const t1=el('div',{class:'tape',style:'top:8px;left:16px;--rot:-10deg'}), t2=el('div',{class:'tape',style:'top:10px;right:20px;--rot:12deg'});
  parent.appendChild(t1); parent.appendChild(t2);
}
function placeholder(){
  return 'data:image/svg+xml;utf8,'+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 240"><defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#ffd3e2"/><stop offset="1" stop-color="#fff5f7"/></linearGradient></defs><rect width="100%" height="100%" fill="url(#g)"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="system-ui" font-size="16" fill="#4d4d4d" opacity=".5">foto</text></svg>`);
}

function turn(next){
  if(next<0 || next>=spreads.length) return;
  book.classList.add('turning'); book.classList.toggle('back', next<cur);
  setTimeout(()=>{ cur=next; renderSpread(cur); updateIndicator(); book.classList.remove('turning','back'); }, 360);
  playFlip();
}
$('#prevBtn').addEventListener('click', ()=>turn(cur-1));
$('#nextBtn').addEventListener('click', ()=>turn(cur+1));
addEventListener('keydown', e=>{ if($('#bookWrap').classList.contains('hidden')) return; if(e.key==='ArrowRight') turn(cur+1); if(e.key==='ArrowLeft') turn(cur-1); });
updateIndicator();
renderSpread(cur);

/* QUIZ */
function renderQuiz(){
  pageL.innerHTML=''; pageR.innerHTML='';
  const state={idx:0,score:0,total:APP_CONFIG.KUIS.length};
  const title=el('h2',{},'kuis kecil');
  const progress=el('div',{class:'progress'}); const bar=el('i'); progress.appendChild(bar);
  const qEl=el('div',{class:'quizQ'}); const choices=el('div',{class:'choices'}); const clue=el('p',{class:'muted'});
  const nextBtn=el('button',{class:'btn ghost'},'berikutnya');
  nextBtn.addEventListener('click',()=>{ if(state.idx>=state.total){ state.idx=0; state.score=0; showStep(); } else showStep(); });
  function showStep(){
    choices.innerHTML=''; clue.textContent='';
    if(state.idx>=state.total){
      const msg = state.score<=1 ? 'kita perlu nambah memori seru lagi üòÑ' : state.score<=3 ? 'lumayan hafal, makin lama makin jago üòâ' : 'kamu hafal aku banget. peluk! ‚ù§Ô∏è';
      qEl.textContent = `hasil: ${state.score}/${state.total}`;
      clue.textContent = msg;
      nextBtn.textContent='ulang kuis';
      bar.style.width='100%';
      return;
    }
    nextBtn.textContent='berikutnya';
    const q=APP_CONFIG.KUIS[state.idx];
    qEl.textContent = `${state.idx+1}. ${q.q}`;
    q.a.forEach((opt,i)=>{
      const b=el('button',{class:'choice',role:'option'}, opt);
      b.addEventListener('click',()=>{
        if(i===q.correct){ b.classList.add('correct'); state.score++; clue.textContent='benar ‚úÖ'; }
        else{ b.classList.add('wrong'); clue.textContent='hmm belum tepat, coba ingat-ingat lagi üòâ'; }
        $$('.choice').forEach(c=>c.disabled=true);
        state.idx++; bar.style.width = Math.min(100, (state.idx/state.total)*100)+'%';
      });
      choices.appendChild(b);
    });
  }
  pageL.appendChild(title); pageL.appendChild(progress); pageL.appendChild(qEl); pageL.appendChild(choices); pageL.appendChild(clue); pageL.appendChild(nextBtn);
  pageR.appendChild(el('div',{class:'paper',style:'padding:12px;'},'<h3 style="margin:0 0 6px 0">catatan</h3><p class="muted">kuis ini cuma buat seru-seruan. hasilnya nggak ngunci fitur apa pun üôÇ</p>'));
  showStep();
}

/* LIGHTBOX */
function openLightbox(src){ $('#lbImg').src=src; $('#lightbox').classList.add('open'); }
$('#lightbox').addEventListener('click',()=>$('#lightbox').classList.remove('open'));

/* MESSAGE MODAL */
$('#openMsg').addEventListener('click',()=>{ $('#messageModal').classList.add('open'); $('#msgTitle').textContent=APP_CONFIG.PESAN_MODAL_TITLE||'tulis pesan'; $('#msgText').placeholder=APP_CONFIG.PESAN_PLACEHOLDER||''; });
$('#closeMsg').addEventListener('click',()=>$('#messageModal').classList.remove('open'));
$('#viewMsgs').addEventListener('click',()=>{ const list=$('#msgList'); const arr=JSON.parse(localStorage.getItem('__msgs')||'[]'); list.innerHTML=''; arr.slice().reverse().forEach(m=>{ const it=el('div',{class:'msgItem'}, `<b>${new Date(m.t).toLocaleString(APP_CONFIG.LOKALE)}</b><br>${escapeHtml(m.text)}`); list.appendChild(it); }); list.classList.toggle('hidden',arr.length===0); });
$('#sendMsg').addEventListener('click', async ()=>{
  const text=$('#msgText').value.trim(); if(!text) return;
  const arr=JSON.parse(localStorage.getItem('__msgs')||'[]'); arr.push({t:Date.now(), text}); localStorage.setItem('__msgs', JSON.stringify(arr));
  try{ await navigator.clipboard.writeText(text); }catch{}
  const wa=APP_CONFIG.WA_TARGET ? `https://wa.me/${APP_CONFIG.WA_TARGET}?text=` : APP_CONFIG.CTA_WHATSAPP;
  const link=`${wa}${encodeURIComponent(text + "\\n\\n" + location.href)}`;
  window.open(link,'_blank');
  $('#msgText').value=''; $('#messageModal').classList.remove('open');
});

/* STICKERS (per spread) */
const stickerKey='__stickers_v1';
$('#stickerToggle').addEventListener('click',()=>$('#stickerPanel').classList.toggle('hidden'));
$('#clearStickers').addEventListener('click',()=>{ const all=JSON.parse(localStorage.getItem(stickerKey)||'{}'); delete all[cur]; localStorage.setItem(stickerKey, JSON.stringify(all)); renderSpread(cur); });
$('#stickerBtns').addEventListener('click',e=>{
  const type=e.target.dataset.stk; if(!type) return;
  const st=createSticker(type); pageR.appendChild(st); saveSticker(st); enableDrag(st);
});
function createSticker(type, data){
  const d=el('div',{class:'sticker',tabindex:"0"});
  d.style.left=(data?.x || 60)+'%'; d.style.top=(data?.y || 60)+'%'; d.style.transform=`translate(-50%,-50%) rotate(${data?.r||0}deg)`;
  d.dataset.type=type;
  let svg='';
  if(type==='heart'){ svg='<svg viewBox="0 0 64 64"><path d="M32 55C-12 28 16 4 32 18 48 4 76 28 32 55Z" fill="#ff6b81"/></svg>'; }
  if(type==='tape'){ svg='<svg viewBox="0 0 120 60"><rect x="6" y="8" width="108" height="44" rx="4" fill="#ffbdce"/><path d="M10 8l6 10M26 8l6 10M42 8l6 10M58 8l6 10M74 8l6 10M90 8l6 10M106 8l6 10" stroke="#e894a8" opacity=".6"/></svg>'; }
  if(type==='butter'){ svg='<svg viewBox="0 0 64 64"><path d="M18 30c-8 0-14-10-10-16 6-8 18 2 20 7-1-6 4-13 10-12 6 1 10 10 6 16" fill="#ffb3c4"/><path d="M46 30c8 0 14-10 10-16-6-8-18 2-20 7 1-6-4-13-10-12-6 1-10 10-6 16" fill="#ffa0b6"/><rect x="30" y="28" width="4" height="14" rx="2" fill="#6d2a3a"/></svg>'; }
  d.innerHTML=svg; d.addEventListener('dblclick',()=>{ rotateSticker(d,15); saveSticker(d); });
  return d;
}
function enableDrag(node){
  node.addEventListener('pointerdown',e=>{ node.setPointerCapture(e.pointerId); node.dataset.drag='1'; node.dataset.dx=e.clientX; node.dataset.dy=e.clientY; });
  node.addEventListener('pointermove',e=>{
    if(node.dataset.drag!=='1') return;
    const dx=e.clientX - (+node.dataset.dx), dy=e.clientY - (+node.dataset.dy);
    const rect=node.parentElement.getBoundingClientRect(); const left=( (node.offsetLeft+dx)/rect.width )*100; const top=( (node.offsetTop+dy)/rect.height )*100;
    node.style.left=left+'%'; node.style.top=top+'%'; node.dataset.dx=e.clientX; node.dataset.dy=e.clientY;
  });
  node.addEventListener('pointerup',()=>{ node.dataset.drag='0'; saveSticker(node); });
}
function rotateSticker(node,deg){ const cur=getRotation(node); node.style.transform=`translate(-50%,-50%) rotate(${cur+deg}deg)`; }
function getRotation(el){ const m=getComputedStyle(el).transform; if(m==='none') return 0; const a=m.match(/matrix\\(([^)]+)\\)/); if(!a) return 0; const vals=a[1].split(','); const angle=Math.round(Math.atan2(vals[1], vals[0]) * (180/Math.PI)); return angle; }
function saveSticker(node){
  const rect=node.parentElement.getBoundingClientRect();
  const x = (node.offsetLeft/rect.width)*100, y=(node.offsetTop/rect.height)*100, r=getRotation(node);
  const all=JSON.parse(localStorage.getItem(stickerKey)||'{}'); all[cur]=all[cur]||[];
  const idx=[...node.parentElement.querySelectorAll('.sticker')].indexOf(node);
  all[cur][idx] = {type:node.dataset.type,x,y,r}; localStorage.setItem(stickerKey, JSON.stringify(all));
}
function renderStickersFor(spreadIndex){
  const all=JSON.parse(localStorage.getItem(stickerKey)||'{}'); const list=all[spreadIndex]||[];
  list.forEach(s=>{ const n=createSticker(s.type,{x:s.x,y:s.y,r:s.r}); pageR.appendChild(n); enableDrag(n); });
}

/* PRINT */
$('#printBtn').addEventListener('click',()=>window.print());

/* LIGHTBOX helpers already added */

/* Service Worker: PWA-lite */
(function registerSW(){
  if(!('serviceWorker' in navigator)) return;
  const assets=['.'].concat((APP_CONFIG.SPREADS||[]).flatMap(s=>s.gambar||[]), [APP_CONFIG.MUSIK_LATAR, APP_CONFIG.OG_IMAGE, 'assets/flip.mp3']).filter(Boolean);
  const code = `
    const CACHE='scrap_v1_'+Date.now();
    const ASSETS=${JSON.stringify(assets)};
    self.addEventListener('install',e=>e.waitUntil(caches.open(CACHE).then(c=>c.addAll(ASSETS)).then(()=>self.skipWaiting())));
    self.addEventListener('activate',e=>e.waitUntil(caches.keys().then(keys=>Promise.all(keys.filter(k=>k.startsWith('scrap_v1_')&&k!==CACHE).map(k=>caches.delete(k)))).then(()=>self.clients.claim())));
    self.addEventListener('fetch',e=>{
      const r=e.request; if(r.method!=='GET') return;
      e.respondWith(caches.match(r).then(m=>m||fetch(r).then(res=>{ const cp=res.clone(); caches.open(CACHE).then(c=>{try{c.put(r,cp)}catch(e){} }); return res; }).catch(()=>caches.match('./'))));
    });
  `;
  const blob=new Blob([code],{type:'text/javascript'}); const url=URL.createObjectURL(blob);
  navigator.serviceWorker.register(url).catch(()=>{}); setTimeout(()=>URL.revokeObjectURL(url),4000);
})();
</script>

<!--
=============================
DEPLOY (Github Pages) ‚Äî 4 langkah
=============================
1) Buat repo ‚Üí upload file ini sebagai `index.html`.
2) (opsional) folder `assets/`:
   - foto1.jpg, foto2.jpg, foto3.jpg, foto4.jpg, foto5.jpg, foto6.jpg, foto7.jpg ‚Äî 1600√ó1200, <300KB/foto (JPEG).
   - love.mp3 ‚Äî 20‚Äì40 detik, 128kbps, <1.5MB.
   - flip.mp3 ‚Äî <100KB (opsional suara ganti halaman).
   - og.jpg ‚Äî 1200√ó630, <200KB.
3) Settings ‚Üí Pages ‚Üí Source: ‚ÄúDeploy from a branch‚Äù, Branch: `main`, Folder: `/ (root)` ‚Üí Save.
4) Tunggu ~1‚Äì2 menit sampai URL aktif ‚Üí buka & cek fitur (flip, kuis, kirim pesan, lightbox, musik, print, offline).

CHECKLIST UJI
- Flip halaman: panah & keyboard ‚Üê/‚Üí, ada efek putar & suara (jika flip.mp3 ada).
- Spread tampil sesuai: foto+quote, foto+note, kolase, surat (markdown), galeri (klik = lightbox).
- Kuis 5 step: skor & pesan hasil, tombol ‚Äúulang kuis‚Äù.
- Tulis Pesan: terkirim ke WhatsApp, tersimpan lokal (lihat daftar), auto-copy.
- Sticker Mode: tambah/drag/rotasi, persist per spread, bersihkan.
- Tema gelap/terang: toggle + simpan preferensi.
- Musik: play/pause, nonaktif jika file tidak ada.
- PWA-lite: setelah 1x dibuka, coba offline ‚Üí halaman tetap berfungsi (kecuali aset yang belum tercache).
- Print: File ‚Üí Print / Save as PDF ‚Üí layout rapih tiap spread.

Catatan:
- Semua teks & konten bisa diubah di window.APP_CONFIG.
- Tanpa CDN, tanpa tracking. A11y & kontras dijaga.
-->
</body>
</html>
