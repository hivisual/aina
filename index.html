<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<title>buat ade ‚Äî deluxe</title>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="description" content="surat interaktif super lengkap buat ade dari mas.">
<meta property="og:title" content="buat ade ‚Äî deluxe">
<meta property="og:description" content="surat interaktif super lengkap buat ade dari mas.">
<meta property="og:type" content="website">
<meta property="og:image" content="assets/og.jpg">
<meta name="theme-color" content="#ff6b81">
<link rel="icon" href='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" rx="24" ry="24" fill="%23ff6b81"/><path d="M24 40h80v48c0 4.4-3.6 8-8 8H32c-4.4 0-8-3.6-8-8V40z" fill="%23fff5f7"/><path d="M24 40l40 28 40-28" fill="none" stroke="%23ff6b81" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/></svg>'>
<style>
:root{
  --c-accent:#ff6b81; --c-soft:#ffd3e2; --c-paper:#fff5f7; --c-text:#4d4d4d;
  --shadow:0 6px 22px rgba(0,0,0,.10); --radius:16px; --radius-xl:22px; --gap:16px;
  --maxw:980px;
}
@media(prefers-color-scheme:dark){
  :root{ --c-paper:#181818; --c-text:#f2f2f2; --c-soft:#2a2224 }
  body{ background:#121212 }
}
[data-theme="dark"]{ color-scheme:dark }
[data-theme="light"]{ color-scheme:light }
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font:16px/1.65 system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif;
  color:var(--c-text);
  background:linear-gradient(180deg,var(--c-soft),#ffffff 40%,var(--c-paper));
}
.container{max-width:var(--maxw);margin:0 auto;padding:24px}
.card{background:var(--c-paper);border-radius:var(--radius-xl);box-shadow:var(--shadow);padding:clamp(16px,3vw,28px)}
h1,h2,h3{margin:0 0 8px 0}
h1{font-size:clamp(24px,5vw,38px)}
h2{font-size:clamp(18px,3.5vw,24px);opacity:.95}
p{margin:0 0 12px 0}
.muted{opacity:.75}
.center{text-align:center}
.hidden{display:none !important}
.toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.tag{display:inline-block;padding:4px 10px;border-radius:999px;background:var(--c-soft);font-size:12px}
.btn{
  appearance:none;border:0;background:var(--c-accent);color:#fff;padding:12px 18px;border-radius:999px;font-weight:600;
  box-shadow:0 6px 16px rgba(255,107,129,.35);cursor:pointer;transition:transform .08s ease, box-shadow .2s;
}
.btn:hover{transform:translateY(-1px)}
.btn:focus-visible{outline:3px solid #0000;box-shadow:0 0 0 3px #fff,0 0 0 6px var(--c-accent)}
.btn.ghost{background:transparent;color:var(--c-accent);border:2px solid var(--c-accent);box-shadow:none}
.btn[disabled]{opacity:.6;cursor:not-allowed}
.section{margin-top:22px}
.grid-2{display:grid;grid-template-columns:1fr;gap:var(--gap)}
@media(min-width:760px){.grid-2{grid-template-columns:1fr 1fr}}
/* cover */
.cover{min-height:72vh;display:grid;place-items:center}
.envelope{width:min(460px,90vw);aspect-ratio:4/3;position:relative;border-radius:18px;overflow:hidden;box-shadow:var(--shadow);background:linear-gradient(180deg,#fff,var(--c-paper))}
.envelope .flap{position:absolute;inset:auto 0 52% 0;height:60%;background:
 linear-gradient(135deg,transparent 49.5%, var(--c-soft) 50%) left,
 linear-gradient(-135deg,transparent 49.5%, var(--c-soft) 50%) right;
 background-size:50% 100%; background-repeat:no-repeat}
.envelope .body{position:absolute;inset:30% 0 0 0;background:var(--c-soft)}
.seal{position:absolute;top:45%;left:50%;transform:translate(-50%,-50%);background:var(--c-accent);color:#fff;width:76px;height:76px;border-radius:50%;display:grid;place-items:center;font-size:28px;box-shadow:0 6px 14px rgba(255,107,129,.5)}
/* typewriter */
.type{border-right:2px solid var(--c-accent);white-space:nowrap;overflow:hidden}
/* countdown boxes */
.timer{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
.box{min-width:72px;background:var(--c-paper);border:1px solid rgba(0,0,0,.06);border-radius:12px;padding:10px;text-align:center}
.box b{font-size:20px;display:block}
/* ring */
.ring{display:grid;place-items:center}
.ring svg{width:160px;height:160px}
.ring .num{position:absolute;font-weight:700;font-size:24px}
/* quiz */
.progress{height:10px;background:rgba(0,0,0,.08);border-radius:999px;overflow:hidden}
.progress>i{display:block;height:100%;width:0%;background:var(--c-accent)}
.choices{display:grid;gap:10px;margin-top:10px}
.choice{padding:10px 14px;border:1px solid rgba(0,0,0,.12);border-radius:12px;background:#fff0;cursor:pointer}
.choice.correct{border-color:rgba(0,180,0,.6)}
.choice.wrong{border-color:rgba(255,0,0,.5)}
/* letter */
.letter{background:var(--c-paper);border-radius:16px;padding:18px;border:1px dashed rgba(0,0,0,.12)}
.letter-actions{display:flex;gap:10px;flex-wrap:wrap}
/* gallery polaroid */
.gallery{display:grid;grid-template-columns:1fr 1fr;gap:var(--gap)}
@media(min-width:760px){.gallery{grid-template-columns:1fr 1fr 1fr}}
.polaroid{position:relative;background:#fff;border-radius:12px;padding:8px;box-shadow:0 10px 22px rgba(0,0,0,.18);transform:rotate(var(--rot,0deg));user-select:none}
.polaroid img{width:100%;height:auto;border-radius:8px;display:block;aspect-ratio:4/3;object-fit:cover}
.polaroid figcaption{text-align:center;font-size:12px;color:#444;margin-top:6px}
.draggable{position:relative}
.draggable.dragging{opacity:.9;cursor:grabbing}
/* timeline */
.timeline{display:grid;grid-auto-flow:column;grid-auto-columns:85%;gap:16px;overflow:auto;scroll-snap-type:x mandatory;padding-bottom:10px}
@media(min-width:760px){.timeline{grid-auto-columns:45%}}
.titem{scroll-snap-align:center;background:var(--c-paper);border-radius:16px;box-shadow:var(--shadow);padding:14px}
.titem img{width:100%;height:auto;border-radius:12px;object-fit:cover;aspect-ratio:16/9}
/* wish board */
.board{position:relative;min-height:320px;border:2px dashed rgba(0,0,0,.12);border-radius:16px;background:
 radial-gradient(800px 200px at 50% 120%, rgba(255,107,129,.08), transparent 60%),
 linear-gradient(180deg,#fff0,var(--c-paper));overflow:hidden}
.heartNote{position:absolute;background:#fff;color:#333;border-radius:18px;padding:8px 10px;font-size:12px;box-shadow:0 10px 22px rgba(0,0,0,.15);border:1px solid rgba(0,0,0,.06);max-width:160px}
.heartNote:before{content:"‚ù§";position:absolute;left:-10px;top:-10px;font-size:18px;color:var(--c-accent)}
/* fireworks canvas */
#fw{position:fixed;inset:0;pointer-events:none;z-index:1000}
/* parallax tilt */
.tilt{transform-style:preserve-3d;transition:transform .15s}
.tilt:hover{transform:perspective(800px) rotateX(var(--rx,0deg)) rotateY(var(--ry,0deg))}
footer{text-align:center;font-size:12px;opacity:.7;padding:18px 0 40px}
@media (prefers-reduced-motion:reduce){
  .btn,.choice{transition:none !important}
  .type{border-right:0}
}
</style>
</head>
<body>
<canvas id="fw"></canvas>
<div class="container">
  <header class="toolbar" aria-label="toolbar">
    <span class="tag" id="whoTag" aria-live="polite"></span>
    <button class="btn ghost" id="shareBtn" aria-label="bagikan via whatsapp">bagikan</button>
    <button class="btn ghost" id="musicBtn" aria-label="putar musik" disabled>putar musik</button>
    <label style="margin-left:auto" class="tag">tema</label>
    <label class="switch">
      <input id="themeToggle" type="checkbox" aria-label="toggle tema">
    </label>
  </header>

  <!-- COVER -->
  <section id="cover" class="cover">
    <div class="card center tilt" id="coverCard">
      <div class="envelope" aria-hidden="true">
        <div class="flap"></div><div class="body"></div><div class="seal">üíå</div>
      </div>
      <h2 id="openingLine" class="muted" style="margin-top:12px"></h2>
      <button class="btn" id="openBtn" aria-label="buka kartu">buka</button>
    </div>
  </section>

  <!-- APP -->
  <main id="app" class="hidden" aria-live="polite">
    <!-- HERO -->
    <section class="card section center tilt" id="hero">
      <h2 id="subHeadline" class="muted"></h2>
      <h1 id="headline" class="type" aria-label="pesan utama"></h1>
      <p id="heroSub" class="muted"></p>
    </section>

    <!-- COUNTDOWN + RING -->
    <section class="card section">
      <div class="grid-2">
        <div class="center">
          <h2 id="countdownTitle">menuju hari spesial</h2>
          <div class="timer" id="timer" aria-live="polite">
            <div class="box"><b id="d">0</b>hari</div>
            <div class="box"><b id="h">0</b>jam</div>
            <div class="box"><b id="m">0</b>menit</div>
            <div class="box"><b id="s">0</b>detik</div>
          </div>
          <p id="countdownNote" class="muted" style="margin-top:6px"></p>
        </div>
        <div class="ring center" style="position:relative">
          <div class="num" id="ringNum">0%</div>
          <svg viewBox="0 0 120 120" aria-label="progress menuju hari H">
            <defs>
              <linearGradient id="g"><stop offset="0" stop-color="var(--c-accent)"/><stop offset="1" stop-color="#ffa3b1"/></linearGradient>
            </defs>
            <circle cx="60" cy="60" r="52" stroke="rgba(0,0,0,.08)" stroke-width="10" fill="none"/>
            <circle id="ring" cx="60" cy="60" r="52" stroke="url(#g)" stroke-width="10" fill="none"
               stroke-linecap="round" transform="rotate(-90 60 60)" stroke-dasharray="327" stroke-dashoffset="327"/>
            <text x="60" y="65" text-anchor="middle" font-size="12" fill="currentColor">menuju hari H</text>
          </svg>
        </div>
      </div>
    </section>

    <!-- QUIZ -->
    <section class="card section" aria-label="kuis kecil">
      <div class="progress" aria-hidden="true"><i id="prog"></i></div>
      <h2 id="quizQ" style="margin-top:10px"></h2>
      <div id="choices" class="choices" role="listbox"></div>
      <p id="clue" class="muted" aria-live="assertive"></p>
      <div class="toolbar" style="margin-top:8px">
        <button class="btn ghost" id="nextBtn">lanjut</button>
        <span id="scoreTag" class="muted"></span>
        <button class="btn" id="unlockBtn" disabled>baca surat</button>
      </div>
    </section>

    <!-- LETTER -->
    <section id="letterSec" class="card section hidden">
      <h2>untuk <span id="toName"></span> ‚ù§Ô∏è</h2>
      <div id="letter" class="letter" tabindex="0"></div>
      <div class="letter-actions" style="margin-top:10px">
        <button class="btn" id="copyBtn">copy</button>
        <button class="btn ghost" id="downloadBtn">download .txt</button>
      </div>
    </section>

    <!-- TIMELINE -->
    <section class="card section" aria-label="timeline">
      <div class="toolbar">
        <h2 style="margin-right:auto">timeline kita</h2>
        <span class="muted">geser ke samping</span>
      </div>
      <div id="timeline" class="timeline"></div>
    </section>

    <!-- GALLERY POLAROID -->
    <section class="card section" aria-label="galeri">
      <div class="toolbar">
        <h2 style="margin-right:auto">galeri polaroid</h2>
        <button class="btn ghost" id="scatterBtn" title="acak & seret foto">scatter & drag</button>
        <button class="btn ghost" id="resetScatter">rapikan</button>
      </div>
      <div id="gallery" class="gallery"></div>
    </section>

    <!-- WISH TREE -->
    <section class="card section" aria-label="pohon harapan">
      <h2>pohon harapan</h2>
      <p class="muted">tulis pesan singkat, jadi hati kecil di papan ini (tersimpan di perangkatmu).</p>
      <div class="toolbar" style="margin:8px 0">
        <input id="wishInput" aria-label="tulis harapan" placeholder="ketik pesan manis..." style="flex:1;padding:10px 12px;border-radius:12px;border:1px solid rgba(0,0,0,.15);background:transparent;color:inherit">
        <button class="btn" id="addWish">tambahkan</button>
        <button class="btn ghost" id="clearWish">bersihkan</button>
      </div>
      <div id="board" class="board" aria-live="polite"></div>
    </section>

    <!-- VOICE NOTE -->
    <section class="card section" aria-label="pesan suara">
      <h2>pesan suara</h2>
      <p class="muted">rekam ucapanmu (lokal/offline), lalu download & kirim ke ade.</p>
      <div class="toolbar">
        <button class="btn" id="recBtn">mulai rekam</button>
        <button class="btn ghost" id="stopBtn" disabled>berhenti</button>
        <audio id="playback" controls style="width:100%"></audio>
        <a id="saveAudio" class="btn ghost" download="voice-untuk-aina.webm" style="display:none">download suara</a>
      </div>
    </section>

    <footer class="muted center">dibuat dengan <span id="emoji">üíñ</span> oleh <span id="fromName"></span></footer>
  </main>
</div>

<!-- Lightbox reused from base (minimal) -->
<div id="lightbox" class="hidden" role="dialog" aria-modal="true" aria-label="pratinjau gambar" style="position:fixed;inset:0;background:rgba(0,0,0,.88);display:flex;align-items:center;justify-content:center;z-index:900">
  <button class="btn ghost" id="lbClose" style="position:absolute;top:20px;right:20px">tutup ‚úï</button>
  <img id="lbImg" alt="gambar galeri" style="max-width:90vw;max-height:80vh;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,.5)">
</div>

<audio id="bgm" preload="none"></audio>

<script>
/* =======================
   APP CONFIG (editable)
   ======================= */
window.APP_CONFIG = {
  NAMA_PENERIMA: "Aina Septitsany Athiya Ramadhani",
  NAMA_PENGIRIM: "mas aren",
  TANGGAL_SPESIAL_ISO: "2025-09-02T00:00:00+07:00",
  PALETA_WARNA: ["#ff6b81","#ffd3e2","#fff5f7","#4d4d4d"],
  FONT_STACK: "system-ui, -apple-system, Segoe UI, Roboto, Inter, sans-serif",
  KALIMAT_PEMBUKA: "hai ade, ada sesuatu buat kamu üíå",
  PESAN_UTAMA_SINGKAT: "makasih sudah jadi rumah ter-nyaman buat aku.",
  SURAT_PANJANG:
`ade,
hari ini aku nggak cuma ngucap ‚Äúselamat ya‚Äù, tapi juga nunjukin sedikit dunia yang lagi kita bangun bareng‚Äîtempat tiap detik kecil bisa jadi momen.

kamu itu jeda yang bikin hari-hari aku balik bernapas. kalau dunia rame, kamu nada yang bikin tenang. makasih udah mau jadi rumah yang ditinggali sabar dan tawa kecil.

kalau badan kurang enak, kepalamu berat, atau hati kamu penuh‚Ä¶ kasih tahu aku. kita tim: kamu istirahat, aku jagain pintunya. kamu cerita, aku dengerin sampai selesai.

aku nggak janji yang besar-besar. aku janji hal kecil tapi konsisten: kabarin kalau pulang, pegang tangan waktu nyebrang, nyiapin minum favoritmu, dan ngulangin ‚Äòhati-hati‚Äô sampai kamu bosen.

semoga langkah kamu ringan, rezeki kamu lancar, dan orang-orang baik selalu di sekelilingmu. semoga kamu selalu merasa dilihat‚Äînggak cuma cantik, tapi juga kuat, cerdas, dan hangat.

buat aku, kamu itu kalimat yang pengen aku baca ulang tiap malam. dan kalau suatu waktu kamu lupa seberapa berartinya kamu, buka halaman ini‚Äîbiar kamu ingat: kamu dicintai, dengan cara yang sederhana tapi serius.

selamat merayakan kamu, aina. mari jalan jauh, pelan, tapi nggak pernah berhenti.`,
  PERTANYAAN_KUIS: [
    {"q":"pertama kali kita ketemu di mana?","a":["kampus","kfc","halte"],"correct":1},
    {"q":"minuman favorit kamu?","a":["matcha","kopi susu","thai tea"],"correct":0},
    {"q":"kucing idaman kita?","a":["scottish fold","anggora","british shorthair"],"correct":2}
  ],
  GALERI_GAMBAR: ["assets/foto1.jpg","assets/foto2.jpg","assets/foto3.jpg"],
  MUSIK_LATAR: "assets/love.mp3",
  CTA_WHATSAPP: "https://wa.me/?text=",
  FALLBACK_EMOJI: "üíñ",
  LOKALE: "id-ID",
  SEO_TITLE: "buat ade ‚Äî deluxe",
  SEO_DESC: "surat interaktif super lengkap buat ade dari mas.",
  OG_IMAGE: "assets/og.jpg",
  TIMELINE: [
    {date:"2024-10-12", title:"awal ngobrol lama", img:"assets/foto1.jpg", note:"malam yang nyambungnya kebangetan"},
    {date:"2025-01-02", title:"first mini date", img:"assets/foto2.jpg", note:"teh hangat + cerita receh"},
    {date:"2025-03-14", title:"jalanan hujan", img:"assets/foto3.jpg", note:"payung kecil, tawa gede"},
    {date:"2025-05-01", title:"rencana kecil", img:"assets/foto1.jpg", note:"pengen liburan tipis-tipis"},
    {date:"2025-09-02", title:"harimu", img:"assets/foto2.jpg", note:"selamat ya, sayang"}
  ]
};

const $=s=>document.querySelector(s); const $$=s=>[...document.querySelectorAll(s)];
const T=APP_CONFIG.TEXTS||{
  buka:"buka", lanjut:"lanjut", bacaSurat:"baca surat", lihatGaleri:"lihat galeri",
  putarMusik:"putar musik", jedaMusik:"jeda musik", bagikan:"bagikan",
  menuju:"menuju hari spesial", hariIni:"hari spesialnya hari ini! üéâ",
  syarat:"jawab minimal 2 benar untuk buka surat",
  benar:"benar ‚úÖ", salah:"hmm belum tepat, coba ingat-ingat lagi üòâ",
  salin:"copy", unduh:"download .txt", placeholderGaleri:"tambahin foto di folder assets/"
};

/* init palette, meta, text */
(function initMeta(){
  const pal=APP_CONFIG.PALETA_WARNA||[];
  const root=document.documentElement;
  if(pal[0]) root.style.setProperty('--c-accent',pal[0]);
  if(pal[1]) root.style.setProperty('--c-soft',pal[1]);
  if(pal[2]) root.style.setProperty('--c-paper',pal[2]);
  if(pal[3]) root.style.setProperty('--c-text',pal[3]);
  document.body.style.fontFamily=APP_CONFIG.FONT_STACK;
  document.title=APP_CONFIG.SEO_TITLE||document.title;
  document.querySelector('meta[name="description"]').setAttribute('content',APP_CONFIG.SEO_DESC||"");
  $('#whoTag').textContent=APP_CONFIG.NAMA_PENERIMA;
  $('#openingLine').textContent=APP_CONFIG.KALIMAT_PEMBUKA;
  $('#musicBtn').textContent=T.putarMusik;
})();

/* theme toggle */
(function themeInit(){
  const key='__theme'; const saved=localStorage.getItem(key);
  const prefersDark=matchMedia('(prefers-color-scheme: dark)').matches;
  const mode=saved|| (prefersDark?'dark':'light');
  document.documentElement.setAttribute('data-theme',mode);
  const toggle=$('#themeToggle'); toggle.checked=(mode==='dark');
  toggle.addEventListener('change',()=>{ const m=toggle.checked?'dark':'light'; document.documentElement.setAttribute('data-theme',m); localStorage.setItem(key,m); });
})();

/* typewriter */
function typewriter(el, text, speed=28){ el.textContent=''; let i=0; const id=setInterval(()=>{ el.textContent=text.slice(0,++i); if(i>=text.length){clearInterval(id); el.classList.remove('type');}},speed); }

/* fireworks (canvas) */
const fwCanvas=$('#fw'); const fctx=fwCanvas.getContext('2d');
function resizeFW(){ fwCanvas.width=innerWidth; fwCanvas.height=innerHeight }
addEventListener('resize',resizeFW); resizeFW();
let particles=[];
function firework(x,y){
  if(matchMedia('(prefers-reduced-motion: reduce)').matches) return;
  for(let i=0;i<70;i++){
    const a=Math.random()*Math.PI*2, v=1+Math.random()*4;
    particles.push({x,y, vx:Math.cos(a)*v, vy:Math.sin(a)*v, life:60+Math.random()*20, color:`hsl(${Math.random()*360},90%,60%)`});
  }
}
function loopFW(){
  fctx.clearRect(0,0,fwCanvas.width,fwCanvas.height);
  particles.forEach(p=>{
    p.x+=p.vx; p.y+=p.vy; p.vy+=0.03; p.life--;
    fctx.fillStyle=p.color; fctx.fillRect(p.x,p.y,2,2);
  });
  particles=particles.filter(p=>p.life>0);
  requestAnimationFrame(loopFW);
}
loopFW();

/* confetti (simple dom) */
function confettiBurst(count=100){
  if(matchMedia('(prefers-reduced-motion: reduce)').matches) return;
  const colors=[APP_CONFIG.PALETA_WARNA[0]||'#ff6b81','#ffd166','#06d6a0','#118ab2','#ef476f'];
  for(let i=0;i<count;i++){
    const e=document.createElement('i'); e.style.position='fixed'; e.style.left=(Math.random()*100)+'vw';
    e.style.top='-10vh'; e.style.width='8px'; e.style.height='14px'; e.style.background=colors[i%colors.length];
    e.style.opacity='.95'; e.style.borderRadius='2px'; e.style.zIndex='999'; e.style.transform=`rotate(${Math.random()*360}deg)`;
    e.style.transition='transform 2.2s linear, top 2.2s linear'; document.body.appendChild(e);
    requestAnimationFrame(()=>{ e.style.top='110vh'; e.style.transform += ' translateY(120vh) rotate(720deg)';});
    setTimeout(()=>e.remove(),2400);
  }
}

/* parallax tilt */
function attachTilt(el){
  el.addEventListener('mousemove',e=>{
    const r=el.getBoundingClientRect(), cx=r.left+r.width/2, cy=r.top+r.height/2;
    const rx=((cy-e.clientY)/r.height)*8, ry=((e.clientX-cx)/r.width)*8;
    el.style.setProperty('--rx',rx+'deg'); el.style.setProperty('--ry',ry+'deg');
  });
  el.addEventListener('mouseleave',()=>{ el.style.setProperty('--rx','0deg'); el.style.setProperty('--ry','0deg'); });
}
attachTilt($('#coverCard')); attachTilt($('#hero'));

/* open cover */
$('#openBtn').addEventListener('click',()=>{
  $('#cover').classList.add('hidden'); $('#app').classList.remove('hidden');
  $('#subHeadline').textContent=APP_CONFIG.KALIMAT_PEMBUKA;
  typewriter($('#headline'),APP_CONFIG.PESAN_UTAMA_SINGKAT);
  $('#heroSub').textContent=`untuk ${APP_CONFIG.NAMA_PENERIMA} dari ${APP_CONFIG.NAMA_PENGIRIM}`;
  confettiBurst(140); firework(innerWidth*0.5, innerHeight*0.35);
});

/* countdown + ring */
const target=new Date(APP_CONFIG.TANGGAL_SPESIAL_ISO);
let msStart = Math.max(1, target - new Date());
function tick(){
  const now=new Date(); let ms=target-now;
  if(ms<=0){
    $('#countdownTitle').textContent=T.hariIni;
    $('#d').textContent='0'; $('#h').textContent='0'; $('#m').textContent='0'; $('#s').textContent='0';
    $('#countdownNote').textContent=new Intl.DateTimeFormat(APP_CONFIG.LOKALE,{dateStyle:'full'}).format(target);
    if(!tick.fired){ confettiBurst(200); firework(innerWidth*0.3, innerHeight*0.4); firework(innerWidth*0.7, innerHeight*0.4); tick.fired=true; }
  }else{
    const d=Math.floor(ms/86400000); ms-=d*86400000;
    const h=Math.floor(ms/3600000); ms-=h*3600000;
    const m=Math.floor(ms/60000); ms-=m*60000;
    const s=Math.floor(ms/1000);
    $('#d').textContent=d; $('#h').textContent=h; $('#m').textContent=m; $('#s').textContent=s;
    $('#countdownNote').textContent=new Intl.DateTimeFormat(APP_CONFIG.LOKALE,{dateStyle:'full',timeStyle:'short'}).format(target);
    // ring
    const ringCirc=327; const ratio = Math.max(0,1-( (target-now) / msStart ));
    $('#ring').setAttribute('stroke-dashoffset', String(ringCirc*(1-ratio)));
    $('#ringNum').textContent = Math.round(ratio*100)+'%';
  }
}
tick(); setInterval(tick,1000);

/* quiz */
const quiz = APP_CONFIG.PERTANYAAN_KUIS.slice(0,3); let idx=0, score=0, chosen=null;
function renderQ(){
  const q=quiz[idx]; $('#quizQ').textContent=q.q; const wrap=$('#choices'); wrap.innerHTML='';
  $('#prog').style.width=((idx)/quiz.length*100)+'%';
  q.a.forEach((opt,i)=>{
    const b=document.createElement('button'); b.className='choice'; b.textContent=opt; b.setAttribute('role','option');
    b.addEventListener('click',()=>{ chosen=i; if(i===q.correct){ b.classList.add('correct'); $('#clue').textContent=T.benar; score++; } else { b.classList.add('wrong'); $('#clue').textContent=T.salah; } $$('.choice').forEach(c=>c.disabled=true); });
    wrap.appendChild(b);
  });
  $('#scoreTag').textContent=`skor: ${score}/${quiz.length}`; $('#clue').textContent=T.syarat;
}
renderQ();
$('#nextBtn').addEventListener('click',()=>{
  if(chosen===null){ $('#clue').textContent='pilih dulu ya üòä'; return; }
  idx++; chosen=null;
  if(idx>=quiz.length){
    $('#prog').style.width='100%'; $('#scoreTag').textContent=`skor: ${score}/${quiz.length}`;
    $('#clue').textContent=score>=2?'kamu lulus! tekan "baca surat"':'belum cukup, coba ulang ya ‚ú®';
    $('#unlockBtn').disabled=!(score>=2); idx=quiz.length-1;
  } else renderQ();
});
$('#unlockBtn').addEventListener('click',()=>{
  if(score<2) return;
  $('#letterSec').classList.remove('hidden'); $('#toName').textContent=APP_CONFIG.NAMA_PENERIMA;
  renderMarkdown('#letter', APP_CONFIG.SURAT_PANJANG); confettiBurst(100); firework(innerWidth*0.5, innerHeight*0.4);
});
/* markdown minimal */
function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }
function renderMarkdown(sel, md){
  const html = md.split('\n\n').map(block=>{
    const b = block.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>').replace(/\*(.+?)\*/g,'<em>$1</em>')
      .split('\n').map(l=>escapeHtml(l)).join('<br>');
    return `<p>${b}</p>`;
  }).join('');
  $(sel).innerHTML=html;
}
/* copy & download */
$('#copyBtn').addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(APP_CONFIG.SURAT_PANJANG); $('#copyBtn').textContent='tersalin ‚úî'; setTimeout(()=>$('#copyBtn').textContent='copy',1500);}catch{} });
$('#downloadBtn').addEventListener('click', ()=>{
  const blob=new Blob([APP_CONFIG.SURAT_PANJANG],{type:'text/plain'}); const a=document.createElement('a');
  a.href=URL.createObjectURL(blob); a.download=`surat-untuk-${APP_CONFIG.NAMA_PENERIMA.replace(/\s+/g,'-').toLowerCase()}.txt`; a.click(); URL.revokeObjectURL(a.href);
});

/* timeline build */
(function buildTimeline(){
  const t=$('#timeline'); const arr=APP_CONFIG.TIMELINE||[];
  arr.forEach(item=>{
    const el=document.createElement('div'); el.className='titem';
    el.innerHTML=`<img src="${item.img||''}" alt="${item.title||'momen'}">
      <h3 style="margin:8px 0 4px 0">${escapeHtml(item.title||'momen')}</h3>
      <p class="muted" style="margin:0">${new Intl.DateTimeFormat(APP_CONFIG.LOKALE,{dateStyle:'medium'}).format(new Date(item.date||Date.now()))}</p>
      <p style="margin-top:6px">${escapeHtml(item.note||'')}</p>`;
    t.appendChild(el);
  });
})();

/* gallery polaroid with scatter & drag */
let scattered=false; const gal=$('#gallery'); buildGallery();
function buildGallery(){
  gal.innerHTML='';
  const imgs=(APP_CONFIG.GALERI_GAMBAR||[]).filter(Boolean);
  if(!imgs.length){ const ph=document.createElement('div'); ph.className='muted'; ph.textContent=T.placeholderGaleri; gal.appendChild(ph); return; }
  imgs.forEach((src,i)=>{
    const fig=document.createElement('figure'); fig.className='polaroid draggable'; fig.style.setProperty('--rot',(Math.random()*10-5)+'deg');
    const img=new Image(); img.src=src; img.alt=`memori ${i+1}`; img.loading='lazy'; img.decoding='async';
    img.addEventListener('click',()=>openLB(src)); fig.appendChild(img);
    const cap=document.createElement('figcaption'); cap.textContent=''; fig.appendChild(cap);
    gal.appendChild(fig);
  });
}
function openLB(src){ $('#lbImg').src=src; $('#lightbox').classList.remove('hidden'); $('#lbClose').focus(); }
$('#lbClose').addEventListener('click',()=>$('#lightbox').classList.add('hidden'));
$('#lightbox').addEventListener('click',e=>{ if(e.target.id==='lightbox') $('#lightbox').classList.add('hidden'); });

$('#scatterBtn').addEventListener('click',()=>{
  scattered=true;
  $$('.draggable').forEach(el=>{
    el.style.position='absolute'; el.style.left=(Math.random()*70+5)+'%'; el.style.top=(Math.random()*40+5)+'%'; el.style.transform=`translate(-50%,-50%) rotate(${(Math.random()*20-10).toFixed(1)}deg)`;
    makeDraggable(el);
  });
  gal.style.position='relative'; gal.style.height='68vh';
});
$('#resetScatter').addEventListener('click',()=>{
  scattered=false; buildGallery(); gal.style.height='auto';
});
function makeDraggable(el){
  let sx=0, sy=0, dragging=false;
  el.addEventListener('pointerdown',e=>{ dragging=true; el.classList.add('dragging'); sx=e.clientX- (parseFloat(el.style.left)||0); sy=e.clientY- (parseFloat(el.style.top)||0); el.setPointerCapture(e.pointerId); });
  el.addEventListener('pointermove',e=>{ if(!dragging) return; el.style.left=(e.clientX - sx)+'px'; el.style.top=(e.clientY - sy)+'px'; });
  el.addEventListener('pointerup',()=>{ dragging=false; el.classList.remove('dragging'); });
}

/* wish board */
const board=$('#board'); const keyWish='__wishes';
function renderWishes(){
  board.innerHTML=''; const Ws=JSON.parse(localStorage.getItem(keyWish)||'[]');
  Ws.forEach(w=>{
    const d=document.createElement('div'); d.className='heartNote'; d.textContent=w.text;
    d.style.left=w.x+'%'; d.style.top=w.y+'%'; board.appendChild(d);
  });
}
renderWishes();
$('#addWish').addEventListener('click',()=>{
  const v=$('#wishInput').value.trim(); if(!v) return;
  const x=10+Math.random()*80, y=10+Math.random()*75;
  const Ws=JSON.parse(localStorage.getItem(keyWish)||'[]'); Ws.push({text:v,x,y}); localStorage.setItem(keyWish,JSON.stringify(Ws));
  $('#wishInput').value=''; renderWishes();
});
$('#clearWish').addEventListener('click',()=>{ localStorage.removeItem(keyWish); renderWishes(); });

/* voice recorder (local) */
const recBtn=$('#recBtn'), stopBtn=$('#stopBtn'), audio=$('#playback'), saveA=$('#saveAudio');
let media, recorder, chunks=[];
recBtn.addEventListener('click',async ()=>{
  try{
    media = await navigator.mediaDevices.getUserMedia({audio:true});
    recorder = new MediaRecorder(media); chunks=[];
    recorder.ondataavailable=e=>{ if(e.data.size>0) chunks.push(e.data); };
    recorder.onstop=()=>{
      const blob=new Blob(chunks,{type:'audio/webm'}); const url=URL.createObjectURL(blob);
      audio.src=url; saveA.href=url; saveA.style.display='inline-flex';
    };
    recorder.start(); recBtn.disabled=true; stopBtn.disabled=false; recBtn.textContent='merekam...';
  }catch{ recBtn.textContent='izin mic ditolak'; }
});
stopBtn.addEventListener('click',()=>{ if(recorder && recorder.state!=='inactive'){ recorder.stop(); media.getTracks().forEach(t=>t.stop()); } recBtn.disabled=false; stopBtn.disabled=true; recBtn.textContent='mulai rekam'; });

/* music */
const bgm=$('#bgm'); const musicBtn=$('#musicBtn');
if(APP_CONFIG.MUSIK_LATAR){ bgm.src=APP_CONFIG.MUSIK_LATAR; bgm.volume=.4; bgm.addEventListener('canplay',()=>musicBtn.disabled=false); bgm.addEventListener('error',()=>musicBtn.disabled=true); }
musicBtn.addEventListener('click', async ()=>{ try{ if(bgm.paused){ await bgm.play(); musicBtn.textContent=T.jedaMusik; } else { bgm.pause(); musicBtn.textContent=T.putarMusik; } }catch{} });

/* share WA */
$('#shareBtn').addEventListener('click',()=>{
  const text=`hai ${APP_CONFIG.NAMA_PENERIMA}, buka web ini ya: ${location.href}\n\n${APP_CONFIG.PESAN_UTAMA_SINGKAT}`;
  location.href = APP_CONFIG.CTA_WHATSAPP + encodeURIComponent(text);
});

/* footer */
$('#emoji').textContent=APP_CONFIG.FALLBACK_EMOJI||'üíñ'; $('#fromName').textContent=APP_CONFIG.NAMA_PENGIRIM;

/* simple SW (PWA-lite) */
(function registerSW(){
  if(!('serviceWorker' in navigator)) return;
  const version='v2.0.0';
  const assets=['.'].concat((APP_CONFIG.GALERI_GAMBAR||[]), [APP_CONFIG.MUSIK_LATAR, APP_CONFIG.OG_IMAGE]).filter(Boolean);
  const sw=`
    const CACHE='love_${version}_'+Date.now();
    const ASSETS=${JSON.stringify(assets)};
    self.addEventListener('install',e=>e.waitUntil(caches.open(CACHE).then(c=>c.addAll(ASSETS)).then(()=>self.skipWaiting())));
    self.addEventListener('activate',e=>e.waitUntil(caches.keys().then(keys=>Promise.all(keys.filter(k=>k.startsWith('love_')&&k!==CACHE).map(k=>caches.delete(k)))).then(()=>self.clients.claim())));
    self.addEventListener('fetch',e=>{ const r=e.request; if(r.method!=='GET') return;
      e.respondWith(caches.match(r).then(m=>m||fetch(r).then(res=>{ const cp=res.clone(); caches.open(CACHE).then(c=>{try{c.put(r,cp)}catch(e){}}); return res; }).catch(()=>caches.match('./'))));
    });
  `;
  const blob=new Blob([sw],{type:'text/javascript'}); const url=URL.createObjectURL(blob);
  navigator.serviceWorker.register(url).catch(()=>{}); setTimeout(()=>URL.revokeObjectURL(url),4000);
})();
</script>

<!--
========================
ASSET SARAN (opsional)
========================
- /assets/foto1.jpg, foto2.jpg, foto3.jpg ‚Äî 1600x1200, <300KB
- /assets/love.mp3 ‚Äî 20‚Äì40 detik, 128kbps, <1.5MB
- /assets/og.jpg ‚Äî 1200x630, <200KB

TES CEPAT
- buka ‚Üí fireworks + confetti muncul; hero tilt saat diarahkan kursor.
- countdown & ring jalan; di hari-H: "hari spesialnya hari ini! üéâ" + fireworks kanan-kiri.
- kuis ‚â•2 benar ‚Üí surat kebuka.
- timeline: geser horizontal.
- galeri: "scatter & drag" untuk seret; "rapikan" untuk balik grid.
- pohon harapan: tambah hati; reload tetap ada (localStorage).
- voice note: klik "mulai rekam" ‚Üí berhenti ‚Üí dengarkan ‚Üí download .webm.
- PWA-lite: setelah 1x load, coba offline ‚Üí halaman tetap muncul (kecuali aset yg belum tercache).

Catatan:
- Semua teks & tanggal bisa diubah di window.APP_CONFIG.
- Tidak ada dependency eksternal. A11y & dark mode aktif.
-->
</body>
</html>
