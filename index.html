<!doctype html>
<html lang="id">
<head> 
  <meta charset="utf-8">
  <title>buat ade â€” ulang tahun (v4 fix)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <meta name="description" content="surat ulang tahun interaktif untuk ade dari mas.">
  <meta property="og:title" content="buat ade â€” ulang tahun">
  <meta property="og:description" content="surat ulang tahun interaktif untuk ade dari mas.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="assets/foto1.jpg">
  <meta name="theme-color" content="#ff6b81">
  <!-- inline favicon svg -->
  <link rel="icon" href='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" rx="24" ry="24" fill="%23ff6b81"/><path d="M24 40h80v48c0 4.4-3.6 8-8 8H32c-4.4 0-8-3.6-8-8V40z" fill="%23fff5f7"/><path d="M24 40l40 28 40-28" fill="none" stroke="%23ff6b81" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/></svg>'>
  <!-- Preload gambar awal -->
  <link rel="preload" as="image" href="assets/foto1.jpg">
  <link rel="preload" as="image" href="assets/foto2.jpg">
  <link rel="preload" as="image" href="assets/foto3.jpg">
  <style>
    :root{
      --c-accent:#ff6b81; --c-soft:#ffd3e2; --c-paper:#fffafc; --c-text:#3a3a3a; --c-ink:#2a2a2a;
      --shadow:0 12px 30px rgba(0,0,0,.08);
      --maxw:960px; --gap:16px; --radius:20px; --speed:300ms;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif; color:var(--c-text);
      background:
        radial-gradient(1200px 600px at 100% -10%,rgba(255,107,129,.12),rgba(255,107,129,0) 60%),
        radial-gradient(800px 400px at -20% 110%,rgba(255,211,226,.25),rgba(255,211,226,0) 60%),
        linear-gradient(180deg,#fff, var(--c-paper));
    }
    .container{max-width:var(--maxw); margin-inline:auto; padding:20px;}
    header.toolbar{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:10px}
    .tag{display:inline-block; padding:6px 12px; border-radius:999px; background:var(--c-soft); color:var(--c-ink); font-weight:600}
    /* stage & page */
    .stage{ position:relative; display:grid; place-items:center; min-height:76vh; }
    .page{
      width:min(720px, 90vw); aspect-ratio:3/4; background:var(--c-paper);
      border-radius:var(--radius); box-shadow:var(--shadow); padding:clamp(14px,2.4vw,24px); overflow:hidden; position:relative;
      border:1px solid rgba(0,0,0,.06);
    }
    .page:before{ content:""; position:absolute; inset:0; pointer-events:none; background:
      linear-gradient(180deg,rgba(255,255,255,.8),rgba(255,255,255,0)),
      repeating-linear-gradient(0deg, rgba(0,0,0,.02), rgba(0,0,0,.02) 2px, rgba(0,0,0,0) 2px, rgba(0,0,0,0) 6px);
      mix-blend-mode:multiply; opacity:.8;
    }
    h1,h2,h3{margin:0 0 8px 0}
    h1{font-size:clamp(22px,4.6vw,34px); letter-spacing:.2px; color:var(--c-ink)}
    h2{font-size:clamp(16px,3.2vw,22px); opacity:.9; color:var(--c-ink)}
    p{margin:0 0 10px 0}
    .muted{opacity:.78}
    .center{text-align:center}
    .btn{appearance:none; border:0; background:var(--c-accent); color:#fff; padding:12px 18px; border-radius:999px; font-weight:700; cursor:pointer; box-shadow:0 10px 26px rgba(255,107,129,.35); transition:transform .08s ease, box-shadow .2s ease}
    .btn:hover{transform:translateY(-1px)}
    .btn.ghost{background:transparent; color:var(--c-accent); border:2px solid var(--c-accent); box-shadow:none}
    .btn.icon{ display:inline-grid; grid-auto-flow:column; align-items:center; gap:8px }
    .content-center{display:grid; place-items:center; height:100%; text-align:center; gap:14px;}
    .fullimg{ position:relative; width:100%; height:100%; display:grid; place-items:center; }
    .fullimg img{ max-width:100%; max-height:100%; object-fit:contain; display:block; border-radius:14px; box-shadow:0 6px 24px rgba(0,0,0,.12); }
    .cover-bg{ position:absolute; inset:0; background-size:cover; background-position:center; filter:brightness(.92); }
    .cover-overlay{ position:absolute; inset:0; background:linear-gradient(180deg, rgba(255,250,252,.55), rgba(255,250,252,.25) 40%, rgba(255,250,252,0)); }
    .cover-content{ position:relative; z-index:2; background:rgba(255,250,252,.5); backdrop-filter:blur(4px); padding:20px; border-radius:16px; box-shadow:0 6px 20px rgba(0,0,0,.08) }
    .tap{ animation:tapblink 1.2s ease-in-out infinite }
    @keyframes tapblink{ 0%{opacity:.4} 50%{opacity:1} 100%{opacity:.4} }
    .reason-card, .gift-card{ background:#fff; padding:16px; border-radius:12px; box-shadow:0 4px 16px rgba(0,0,0,.07); animation:fade-item .4s ease both; }
    .reason-card:nth-child(2){animation-delay:.15s} .reason-card:nth-child(3){animation-delay:.3s}
    @keyframes fade-item{ from{opacity:0; transform:translateY(10px)} }
    .checklist{list-style:none; padding:0; text-align:left; width:min(560px,90%); margin:0 auto}
    .checklist li{display:flex; align-items:center; gap:10px; margin-bottom:8px; padding:10px 12px; border:1px solid rgba(0,0,0,.08); border-radius:12px; background:#fff}
    .checklist input{accent-color:var(--c-accent); width:20px; height:20px}
    .quiz{ display:grid; gap:12px; height:100%; align-content:center; justify-items:stretch; grid-auto-rows:max-content; padding-inline:clamp(4px,2vw,16px); }
    .choices{ display:grid; gap:10px; margin-top:8px }
    .choice{ padding:12px 14px; border:1px solid rgba(0,0,0,.12); border-radius:12px; cursor:pointer; background:#fff; text-align:left; font-size:16px; width:100%; }
    .choice:disabled{ opacity:.7 }
    .typewriter-text{ width:fit-content; margin-inline:auto; overflow:hidden; white-space:nowrap; border-right:2px solid var(--c-accent); animation:typing 2s steps(30, end), blink-caret .75s step-end infinite; }
    @keyframes typing{ from{width:0} to{width:100%} }
    @keyframes blink-caret{ from,to{border-color:transparent} 50%{border-color:var(--c-accent)} }
    /* candle */
    .cake{ position:relative; width:220px; height:140px; margin:0 auto; }
    .cake .body{ position:absolute; bottom:0; left:0; right:0; height:100px; background:linear-gradient(180deg,#ffd3e2,#ffb3c6); border-radius:16px; box-shadow:inset 0 4px 10px rgba(0,0,0,.06) }
    .cake .candle{ position:absolute; left:50%; transform:translateX(-50%); bottom:92px; width:12px; height:40px; background:#fff; border-radius:6px }
    .cake .flame{ position:absolute; left:50%; transform:translateX(-50%); bottom:130px; width:16px; height:26px; background:radial-gradient(circle at 50% 35%, #fff7b1 0%, #ffd166 60%, #ff6b6b 100%); border-radius:50% 50% 50% 50% / 60% 60% 40% 40%; filter:blur(.2px); box-shadow:0 0 16px 6px rgba(255,215,97,.6); transition:opacity .3s ease, transform .3s ease }
    .cake .flame.off{ opacity:0; transform:translateX(-50%) scale(.6); box-shadow:none }
    /* bottom navigation */
    .navwrap{ position:fixed; left:0; right:0; bottom:clamp(10px, env(safe-area-inset-bottom) + 10px, 24px); z-index:50; display:grid; place-items:center; pointer-events:none }
    .nav{ pointer-events:auto; display:flex; align-items:center; gap:12px; background:rgba(255,255,255,.92); backdrop-filter:blur(6px); border:1px solid rgba(0,0,0,.06); border-radius:999px; padding:8px 12px; box-shadow:0 8px 24px rgba(0,0,0,.12) }
    .nav .pill{ min-width:38px; height:38px; border-radius:999px; display:grid; place-items:center; font-size:18px; font-weight:700; color:#fff; background:var(--c-accent); border:0; cursor:pointer }
    .nav .pill:disabled{ opacity:.5; cursor:not-allowed }
    .nav .count{ font-weight:700; color:var(--c-ink); padding:0 6px }
    .prog{ position:absolute; left:50%; transform:translateX(-50%); bottom:calc(100% + 6px); width:min(720px,90vw); height:6px; background:rgba(0,0,0,.06); border-radius:999px; overflow:hidden }
    .prog>i{ display:block; height:100%; width:0%; background:var(--c-accent) }
    /* animations */
    .fade{ animation:fade .35s ease both }
    @keyframes fade{ from{ opacity:0; transform:translateY(6px) } }
    .slide{ animation:slide .35s ease both }
    @keyframes slide{ from{ transform:translateX(10px); opacity:0 } }
    footer{ text-align:center; font-size:12px; opacity:.7; padding:14px 0 56px }
    /* lightbox */
    .lightbox{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.85); z-index:1000 }
    .lightbox.open{ display:flex }
    .lightbox img{ max-width:92vw; max-height:86vh; border-radius:14px; box-shadow:0 16px 60px rgba(0,0,0,.6) }
    .lightbox .close{ position:absolute; top:16px; right:16px }
    /* reduced motion */
    @media (prefers-reduced-motion:reduce){
      .btn, .choice{ transition:none !important; animation:none !important }
    }
    #musicBtn{ position:fixed; top:16px; right:16px; z-index:100; font-size:24px; background:rgba(255,255,255,.9); border-radius:50%; width:44px; height:44px; border:0; cursor:pointer; box-shadow:0 8px 24px rgba(0,0,0,.12) }
  </style>
</head>
<body>
  <div class="container">
    <header class="toolbar" aria-label="toolbar">
      <span class="tag" id="whoTag"></span>
    </header>
    <div class="stage">
      <section id="page" class="page fade" aria-live="polite" aria-label="halaman"></section>
    </div>
    <footer class="muted">dibuat dengan <span id="emoji">ðŸ’–</span> oleh <span id="fromName"></span></footer>
  </div>
  
  <div class="navwrap" aria-hidden="false">
    <div class="prog"><i id="prog"></i></div>
    <div class="nav" role="navigation" aria-label="navigasi halaman">
      <button class="pill" id="prevBtn" aria-label="halaman sebelumnya">âŸµ</button>
      <div class="count" id="pageCount">1/20</div>
      <button class="pill" id="nextBtn" aria-label="halaman berikutnya">âŸ¶</button>
    </div>
  </div>
  
  <button id="musicBtn" aria-label="putar/hentikan musik" style="display:none;">ðŸŽµ</button>
  <audio id="bgm" preload="none" loop></audio>
  <!-- lightbox -->
  <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-label="pratinjau gambar">
    <button class="btn ghost close" id="lbClose">tutup âœ•</button>
    <img id="lbImg" alt="gambar pratinjau">
  </div>
  <div id="confetti" style="position:fixed;inset:0;pointer-events:none;overflow:visible"></div>
  <script>
  // =======================
  // KONFIG (edit di sini)
  // =======================
  window.APP_CONFIG = {
    NAMA_PENERIMA: "Athiya",
    NAMA_PENGIRIM: "mas aren",
    NOMOR_WA_PENGIRIM: "6281234567890",
    BGM_SRC: "assets/bgm.mp3",
    FOTO_1_COVER: "assets/foto1.jpg",
    FOTO_2_KOLASE: "assets/foto2.jpg",
    FOTO_3_GALERI: "assets/foto3.jpg",
    FOTO_4_SURAT: "assets/foto4.jpg",
    PAGE_01: { TITLE: "selamat ulang tahun, ade sayang âœ¨", COPY: "hari ini mas ngetuk layar ade, bawa banyak peluk yang nyampein rindu." },
    PAGE_02: { COPY: "meski ada jarak antar kota, tiap halaman ini mas isi buat nemenin ade. anggep aja setiap geseran layar = mas jalan selangkah lebih deket. lama-lama bukan cuma layar, tapi mas beneran ada di sebelah ade.." },
    PAGE_03: { COPY: "semoga hari ini penuh tawa. makasih sudah jadi cerita paling manis buat mas." },
    PAGE_04: {
      TITLE: "alasan mas bangga punya ade",
      REASONS: [
        "<strong>Tulus & kuat</strong> â€” cantik lucu ayuu",
        "<strong>Peka & perhatian</strong> â€” pinter, cepet belajar, banyak bisanya",
        "<strong>Ngejar mimpi</strong> â€” baik, penurut, bisa kontrol diri walau lagi marah",
        "<strong>Ngejar mimpi</strong> â€” istriable banget",
        "<strong>Ngejar mimpi</strong> â€” dan masih banyak lagii..",
      ],
    },
    PAGE_05: { COPY: "ini koleksi favorit mas. tiap lihat, rasanya pulang." },
    PAGE_07: {
      TITLE: "ðŸŽ hadiah dari mas yang udah nyampe ada makna yang ikut sampe ke hati juga",
      GIFTS: [
        { icon: "ðŸŒ¸", title: "bunga", desc: "buat ade yang selalu jadi obat hati mas, tiap kelopaknya seperti ucapan â€œsemoga ade bahagia" },
        { icon: "ðŸ‘œ", title: "tas", desc: "biar langkah ade enteng, apa pun yang ade bawa mas ikut jagain, seakan mas selalu di samping" },
        { icon: "â“", title: "blindbox", desc: "kejutan kecil, kayak mas yang ga pernah habis idenya bikin ade senyum-senyum" },
      ],
      CLOSING: "kalo kangen, ade cukup liat ini.. rasanya mas hadir nemenin ade, walau dari jauh",
    },
    PAGE_08: {
      TITLE: "ada banyak hal sederhana yang bisa bikin jarak kita ga kerasa jauh. ini wishlist kecil kita, biar tiap hari ada alasan senyum ðŸ’Œ",
      PLANS: [
        "cium online tiap hari",
        "kirim pap",
        "nonton film bareng sambil vc",
        "dinner virtual",
        "main roblox bareng",
        "foto â€˜tangan loveâ€™ tiap minggu",
        "doa bareng sebelum tidur",
        "ngobrol sebelum tidur",
      ],
    },
    PAGE_09: { COPY: "coba kita flashback dikit yuk ðŸ¥°\npilih jawaban yang paling bener versi ade, biar keliatan seberapa hafal sama momen kita." },
    PAGE_16: { TITLE: "Doa & Harapan Tahun Ini", PRAYER: "semoga ade makin sehat, hati tenang, sekolah lancar, rezeki deras, jualan laris. apa pun yang ade kejar, mas dukung penuh. langkah ade dimudahkan, doa-doa baiknya satu-satu dikabulkan." },
    PAGE_17: { TITLE: "janji kecil mas ke adee", PROMISES: [
      "pas nge-date lebih fokus ke tangan ade, bukan gigi",
      "tiap hari bilang ade cantik/ayu",
      "mau diajakin jajaan",
      "sama ade sampe kapanpun" ] },
    PAGE_18: { COPY: "udah? sekarang swipe ke atas untuk tiup lilinnya ðŸŽ‚, mas yang aminin semua doa ade ðŸ¤" },
    PAGE_19: { COPY: "terima kasih sudah jadi rumah ternyaman buat mas." },
    PAGE_20: { CLOSING: "dibuat dengan â¤ï¸ oleh mas aren. kalau ade mau simpan, tekan tombol di bawah." },
    // Kuis dll (biar pendek, sama kayak kode asli)
    PERTANYAAN_KUIS: [...],
    HASIL_KUIS_PROFIL: {...}
  };

  // >>>> PATCH di bawah: Musik guard + SW cache fix
  const bgm=$('#bgm'), musicBtn=$('#musicBtn');
  bgm.src=APP_CONFIG.BGM_SRC; bgm.volume=.35;
  let musicReady=false, musicPlaying=false;
  bgm.addEventListener('canplay', ()=>{ musicReady=true; musicBtn.style.display='block'; });
  function playMusic(){ if(!musicReady) return; bgm.play().then(()=>{ musicPlaying=true; musicBtn.textContent='ðŸŽµ'; }).catch(()=>{}); }
  function pauseMusic(){ try{ bgm.pause(); musicPlaying=false; musicBtn.textContent='ðŸ”‡'; }catch{} }
  musicBtn.addEventListener('click', ()=>{ if(bgm.paused) playMusic(); else pauseMusic(); });
  function autoMusicGuard(){ 
    if(page>=9 && page<=15) { if(!bgm.paused) pauseMusic(); }
    else { if(bgm.paused && musicPlaying) playMusic(); }
  }
  // >>>> Confetti animation fix
  const styleAnim=document.createElement('style');
  styleAnim.textContent=`@keyframes fall {
    from{transform:translateY(0) rotate(0);opacity:1}
    to{transform:translateY(110vh) rotate(720deg);opacity:.98}
  }`;
  document.head.appendChild(styleAnim);
  // >>>> Service Worker cache version fix
  (function registerSW(){
    if(!('serviceWorker' in navigator)) return;
    const version='v4.1.0';
    const assets=['.','assets/foto1.jpg','assets/foto2.jpg','assets/foto3.jpg','assets/foto4.jpg'].filter(Boolean);
    const swCode=`
      const CACHE='love_${version}';
      const ASSETS=${JSON.stringify(assets)};
      self.addEventListener('install',e=>{ e.waitUntil(caches.open(CACHE).then(c=>c.addAll(ASSETS)).then(()=>self.skipWaiting())) });
      self.addEventListener('activate',e=>{ e.waitUntil(caches.keys().then(keys=>Promise.all(keys.filter(k=>k.startsWith('love_') && k!==CACHE).map(k=>caches.delete(k)))).then(()=>self.clients.claim())) });
      self.addEventListener('fetch',e=>{ const req=e.request; if(req.method!=='GET') return; e.respondWith(caches.match(req).then(r=> r || fetch(req).then(res=>{ const copy=res.clone(); caches.open(CACHE).then(c=>{ try{ c.put(req, copy) }catch(e){} }); return res; }).catch(()=>caches.match('./')))) });
    `;
    const blob=new Blob([swCode],{type:'text/javascript'}); const url=URL.createObjectURL(blob);
    navigator.serviceWorker.register(url).catch(()=>{}); setTimeout(()=>URL.revokeObjectURL(url), 4000);
  })();
  </script>
</body>
</html>
